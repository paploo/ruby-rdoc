<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>new (Regexp)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre>/*
 *  call-seq:
 *     Regexp.new(string [, options])                =&gt; regexp
 *     Regexp.new(regexp)                            =&gt; regexp
 *     Regexp.compile(string [, options])            =&gt; regexp
 *     Regexp.compile(regexp)                        =&gt; regexp
 *
 *  Constructs a new regular expression from &lt;i&gt;pattern&lt;/i&gt;, which can be either
 *  a &lt;code&gt;String&lt;/code&gt; or a &lt;code&gt;Regexp&lt;/code&gt; (in which case that regexp's
 *  options are propagated, and new options may not be specified (a change as of
 *  Ruby 1.8). If &lt;i&gt;options&lt;/i&gt; is a &lt;code&gt;Fixnum&lt;/code&gt;, it should be one or
 *  more of the constants &lt;code&gt;Regexp::EXTENDED&lt;/code&gt;,
 *  &lt;code&gt;Regexp::IGNORECASE&lt;/code&gt;, and &lt;code&gt;Regexp::MULTILINE&lt;/code&gt;,
 *  &lt;em&gt;or&lt;/em&gt;-ed together. Otherwise, if &lt;i&gt;options&lt;/i&gt; is not
 *  &lt;code&gt;nil&lt;/code&gt;, the regexp will be case insensitive.
 *
 *     r1 = Regexp.new('^a-z+:\\s+\w+')           #=&gt; /^a-z+:\s+\w+/
 *     r2 = Regexp.new('cat', true)               #=&gt; /cat/i
 *     r3 = Regexp.new('dog', Regexp::EXTENDED)   #=&gt; /dog/x
 *     r4 = Regexp.new(r2)                        #=&gt; /cat/i
 */

static VALUE
rb_reg_initialize_m(int argc, VALUE *argv, VALUE self)
{
    onig_errmsg_buffer err = &quot;&quot;;
    int flags = 0;
    VALUE str;
    rb_encoding *enc;
    const char *ptr;
    long len;

    if (argc == 0 || argc &gt; 3) {
        rb_raise(rb_eArgError, &quot;wrong number of arguments&quot;);
    }
    if (TYPE(argv[0]) == T_REGEXP) {
        VALUE re = argv[0];

        if (argc &gt; 1) {
            rb_warn(&quot;flags ignored&quot;);
        }
        rb_reg_check(re);
        flags = rb_reg_options(re);
        ptr = RREGEXP_SRC_PTR(re);
        len = RREGEXP_SRC_LEN(re);
        enc = rb_enc_get(re);
        if (rb_reg_initialize(self, ptr, len, enc, flags, err)) {
            str = rb_enc_str_new(ptr, len, enc);
            rb_reg_raise_str(str, flags, err);
        }
    }
    else {
        if (argc &gt;= 2) {
            if (FIXNUM_P(argv[1])) flags = FIX2INT(argv[1]);
            else if (RTEST(argv[1])) flags = ONIG_OPTION_IGNORECASE;
        }
        enc = 0;
        if (argc == 3 &amp;&amp; !NIL_P(argv[2])) {
            char *kcode = StringValuePtr(argv[2]);
            if (kcode[0] == 'n' || kcode[1] == 'N') {
                enc = rb_ascii8bit_encoding();
                flags |= ARG_ENCODING_NONE;
            }
            else {
                rb_warn(&quot;encoding option is ignored - %s&quot;, kcode);
            }
        }
        str = argv[0];
        ptr = StringValuePtr(str);
        if (enc
            ? rb_reg_initialize(self, ptr, RSTRING_LEN(str), enc, flags, err)
            : rb_reg_initialize_str(self, str, flags, err)) {
            rb_reg_raise_str(str, flags, err);
        }
    }
    return self;
}</pre>
</body>
</html>
