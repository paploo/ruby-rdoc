<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>process_args (RDoc::RI::Driver)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="../../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre>     <span class="ruby-comment cmt"># File lib/rdoc/ri/driver.rb, line 98</span>
 98:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">process_args</span>(<span class="ruby-identifier">argv</span>)
 99:     <span class="ruby-identifier">options</span> = <span class="ruby-identifier">default_options</span>
100: 
101:     <span class="ruby-identifier">opts</span> = <span class="ruby-constant">OptionParser</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">opt</span><span class="ruby-operator">|</span>
102:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">program_name</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span> <span class="ruby-identifier">$0</span>
103:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">version</span> = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">VERSION</span>
104:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">release</span> = <span class="ruby-keyword kw">nil</span>
105:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">summary_indent</span> = <span class="ruby-value str">' '</span> <span class="ruby-operator">*</span> <span class="ruby-value">4</span>
106: 
107:       <span class="ruby-identifier">directories</span> = [
108:         <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">RI</span><span class="ruby-operator">::</span><span class="ruby-constant">Paths</span><span class="ruby-operator">::</span><span class="ruby-constant">SYSDIR</span>,
109:         <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">RI</span><span class="ruby-operator">::</span><span class="ruby-constant">Paths</span><span class="ruby-operator">::</span><span class="ruby-constant">SITEDIR</span>,
110:         <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">RI</span><span class="ruby-operator">::</span><span class="ruby-constant">Paths</span><span class="ruby-operator">::</span><span class="ruby-constant">HOMEDIR</span>
111:       ]
112: 
113:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">RI</span><span class="ruby-operator">::</span><span class="ruby-constant">Paths</span><span class="ruby-operator">::</span><span class="ruby-constant">GEMDIRS</span> <span class="ruby-keyword kw">then</span>
114:         <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">path</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">dir</span><span class="ruby-operator">|</span>
115:           <span class="ruby-identifier">directories</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{dir}/doc/*/ri&quot;</span>
116:         <span class="ruby-keyword kw">end</span>
117:       <span class="ruby-keyword kw">end</span>
118: 
119:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">banner</span> = <span class="ruby-value str">&quot;Usage: \#{opt.program_name} [options] [names...]\n\nWhere name can be:\n\nClass | Class::method | Class#method | Class.method | method\n\nAll class names may be abbreviated to their minimum unambiguous form. If a name\nis ambiguous, all valid options will be listed.\n\nThe form '.' method matches either class or instance methods, while #method\nmatches only instance and ::method matches only class methods.\n\nFor example:\n\n\#{opt.program_name} Fil\n\#{opt.program_name} File\n\#{opt.program_name} File.new\n\#{opt.program_name} zip\n\nNote that shell quoting may be required for method names containing\npunctuation:\n\n\#{opt.program_name} 'Array.[]'\n\#{opt.program_name} compact\\\\!\n\nBy default ri searches for documentation in the following directories:\n\n\#{directories.join \&quot;\\n    \&quot;}\n\nSpecifying the --system, --site, --home, --gems or --doc-dir options will\nlimit ri to searching only the specified directories.\n\nOptions may also be set in the 'RI' environment variable.\n&quot;</span>
120: 
121:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">separator</span> <span class="ruby-keyword kw">nil</span>
122:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">separator</span> <span class="ruby-value str">&quot;Options:&quot;</span>
123:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">separator</span> <span class="ruby-keyword kw">nil</span>
124: 
125:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--fmt=FORMAT&quot;</span>, <span class="ruby-value str">&quot;--format=FORMAT&quot;</span>, <span class="ruby-value str">&quot;-f&quot;</span>,
126:              <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">RI</span><span class="ruby-operator">::</span><span class="ruby-constant">Formatter</span><span class="ruby-operator">::</span><span class="ruby-constant">FORMATTERS</span>.<span class="ruby-identifier">keys</span>,
127:              <span class="ruby-value str">&quot;Format to use when displaying output:&quot;</span>,
128:              <span class="ruby-node">&quot;   #{RDoc::RI::Formatter.list}&quot;</span>,
129:              <span class="ruby-value str">&quot;Use 'bs' (backspace) with most pager&quot;</span>,
130:              <span class="ruby-value str">&quot;programs. To use ANSI, either disable the&quot;</span>,
131:              <span class="ruby-value str">&quot;pager or tell the pager to allow control&quot;</span>,
132:              <span class="ruby-value str">&quot;characters.&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
133:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:formatter</span>] = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">RI</span><span class="ruby-operator">::</span><span class="ruby-constant">Formatter</span>.<span class="ruby-identifier">for</span> <span class="ruby-identifier">value</span>
134:       <span class="ruby-keyword kw">end</span>
135: 
136:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">separator</span> <span class="ruby-keyword kw">nil</span>
137: 
138:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--doc-dir=DIRNAME&quot;</span>, <span class="ruby-value str">&quot;-d&quot;</span>, <span class="ruby-constant">Array</span>,
139:              <span class="ruby-value str">&quot;List of directories from which to source&quot;</span>,
140:              <span class="ruby-value str">&quot;documentation in addition to the standard&quot;</span>,
141:              <span class="ruby-value str">&quot;directories.  May be repeated.&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
142:         <span class="ruby-identifier">value</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">dir</span><span class="ruby-operator">|</span>
143:           <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-identifier">dir</span> <span class="ruby-keyword kw">then</span>
144:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">OptionParser</span><span class="ruby-operator">::</span><span class="ruby-constant">InvalidArgument</span>, <span class="ruby-node">&quot;#{dir} is not a directory&quot;</span>
145:           <span class="ruby-keyword kw">end</span>
146: 
147:           <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:extra_doc_dirs</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">dir</span>)
148:         <span class="ruby-keyword kw">end</span>
149:       <span class="ruby-keyword kw">end</span>
150: 
151:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">separator</span> <span class="ruby-keyword kw">nil</span>
152: 
153:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--[no-]use-cache&quot;</span>,
154:              <span class="ruby-value str">&quot;Whether or not to use ri's cache.&quot;</span>,
155:              <span class="ruby-value str">&quot;True by default.&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
156:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_cache</span>] = <span class="ruby-identifier">value</span>
157:       <span class="ruby-keyword kw">end</span>
158: 
159:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">separator</span> <span class="ruby-keyword kw">nil</span>
160: 
161:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--no-standard-docs&quot;</span>,
162:              <span class="ruby-value str">&quot;Do not include documentation from&quot;</span>,
163:              <span class="ruby-value str">&quot;the Ruby standard library, site_lib,&quot;</span>,
164:              <span class="ruby-value str">&quot;installed gems, or ~/.rdoc.&quot;</span>,
165:              <span class="ruby-value str">&quot;Equivalent to specifying&quot;</span>,
166:              <span class="ruby-value str">&quot;the options --no-system, --no-site, --no-gems,&quot;</span>,
167:              <span class="ruby-value str">&quot;and --no-home&quot;</span>) <span class="ruby-keyword kw">do</span>
168:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_system</span>] = <span class="ruby-keyword kw">false</span>
169:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_site</span>] = <span class="ruby-keyword kw">false</span>
170:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_gems</span>] = <span class="ruby-keyword kw">false</span>
171:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_home</span>] = <span class="ruby-keyword kw">false</span>
172:       <span class="ruby-keyword kw">end</span>
173: 
174:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">separator</span> <span class="ruby-keyword kw">nil</span>
175: 
176:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--[no-]system&quot;</span>,
177:              <span class="ruby-value str">&quot;Include documentation from Ruby's standard&quot;</span>,
178:              <span class="ruby-value str">&quot;library.  Defaults to true.&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
179:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_system</span>] = <span class="ruby-identifier">value</span>
180:       <span class="ruby-keyword kw">end</span>
181: 
182:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">separator</span> <span class="ruby-keyword kw">nil</span>
183: 
184:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--[no-]site&quot;</span>,
185:              <span class="ruby-value str">&quot;Include documentation from libraries&quot;</span>,
186:              <span class="ruby-value str">&quot;installed in site_lib.&quot;</span>,
187:              <span class="ruby-value str">&quot;Defaults to true.&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
188:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_site</span>] = <span class="ruby-identifier">value</span>
189:       <span class="ruby-keyword kw">end</span>
190: 
191:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">separator</span> <span class="ruby-keyword kw">nil</span>
192: 
193:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--[no-]gems&quot;</span>,
194:              <span class="ruby-value str">&quot;Include documentation from RubyGems.&quot;</span>,
195:              <span class="ruby-value str">&quot;Defaults to true.&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
196:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_gems</span>] = <span class="ruby-identifier">value</span>
197:       <span class="ruby-keyword kw">end</span>
198: 
199:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">separator</span> <span class="ruby-keyword kw">nil</span>
200: 
201:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--[no-]home&quot;</span>,
202:              <span class="ruby-value str">&quot;Include documentation stored in ~/.rdoc.&quot;</span>,
203:              <span class="ruby-value str">&quot;Defaults to true.&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
204:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_home</span>] = <span class="ruby-identifier">value</span>
205:       <span class="ruby-keyword kw">end</span>
206: 
207:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">separator</span> <span class="ruby-keyword kw">nil</span>
208: 
209:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--list-doc-dirs&quot;</span>,
210:              <span class="ruby-value str">&quot;List the directories from which ri will&quot;</span>,
211:              <span class="ruby-value str">&quot;source documentation on stdout and exit.&quot;</span>) <span class="ruby-keyword kw">do</span>
212:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:list_doc_dirs</span>] = <span class="ruby-keyword kw">true</span>
213:       <span class="ruby-keyword kw">end</span>
214: 
215:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">separator</span> <span class="ruby-keyword kw">nil</span>
216: 
217:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--no-pager&quot;</span>, <span class="ruby-value str">&quot;-T&quot;</span>,
218:              <span class="ruby-value str">&quot;Send output directly to stdout,&quot;</span>,
219:              <span class="ruby-value str">&quot;rather than to a pager.&quot;</span>) <span class="ruby-keyword kw">do</span>
220:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_stdout</span>] = <span class="ruby-keyword kw">true</span>
221:       <span class="ruby-keyword kw">end</span>
222: 
223:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--interactive&quot;</span>, <span class="ruby-value str">&quot;-i&quot;</span>,
224:              <span class="ruby-value str">&quot;This makes ri go into interactive mode.&quot;</span>,
225:              <span class="ruby-value str">&quot;When ri is in interactive mode it will&quot;</span>,
226:              <span class="ruby-value str">&quot;allow the user to disambiguate lists of&quot;</span>,
227:              <span class="ruby-value str">&quot;methods in case multiple methods match&quot;</span>,
228:              <span class="ruby-value str">&quot;against a method search string.  It also&quot;</span>,
229:              <span class="ruby-value str">&quot;will allow the user to enter in a method&quot;</span>,
230:              <span class="ruby-value str">&quot;name (with auto-completion, if readline&quot;</span>,
231:              <span class="ruby-value str">&quot;is supported) when viewing a class.&quot;</span>) <span class="ruby-keyword kw">do</span>
232:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:interactive</span>] = <span class="ruby-keyword kw">true</span>
233:       <span class="ruby-keyword kw">end</span>
234: 
235:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">separator</span> <span class="ruby-keyword kw">nil</span>
236: 
237:       <span class="ruby-identifier">opt</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">&quot;--width=WIDTH&quot;</span>, <span class="ruby-value str">&quot;-w&quot;</span>, <span class="ruby-constant">OptionParser</span><span class="ruby-operator">::</span><span class="ruby-constant">DecimalInteger</span>,
238:              <span class="ruby-value str">&quot;Set the width of the output.&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
239:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:width</span>] = <span class="ruby-identifier">value</span>
240:       <span class="ruby-keyword kw">end</span>
241:     <span class="ruby-keyword kw">end</span>
242: 
243:     <span class="ruby-identifier">argv</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'RI'</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">argv</span>
244: 
245:     <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">parse!</span> <span class="ruby-identifier">argv</span>
246: 
247:     <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:names</span>] = <span class="ruby-identifier">argv</span>
248: 
249:     <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:formatter</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">RI</span><span class="ruby-operator">::</span><span class="ruby-constant">Formatter</span>.<span class="ruby-identifier">for</span>(<span class="ruby-value str">'plain'</span>)
250:     <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_stdout</span>] <span class="ruby-operator">||=</span> <span class="ruby-operator">!</span><span class="ruby-identifier">$stdout</span>.<span class="ruby-identifier">tty?</span>
251:     <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_stdout</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:interactive</span>]
252:     <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:width</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">72</span>
253: 
254:     <span class="ruby-identifier">options</span>
255: 
256:   <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">OptionParser</span><span class="ruby-operator">::</span><span class="ruby-constant">InvalidArgument</span>, <span class="ruby-constant">OptionParser</span><span class="ruby-operator">::</span><span class="ruby-constant">InvalidOption</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
257:     <span class="ruby-identifier">puts</span> <span class="ruby-identifier">opts</span>
258:     <span class="ruby-identifier">puts</span>
259:     <span class="ruby-identifier">puts</span> <span class="ruby-identifier">e</span>
260:     <span class="ruby-identifier">exit</span> <span class="ruby-value">1</span>
261:   <span class="ruby-keyword kw">end</span></pre>
</body>
</html>
