<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>parse_program_or_module (RDoc::Parser::F95)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="../../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre>      <span class="ruby-comment cmt"># File lib/rdoc/parser/f95.rb, line 354</span>
 354:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_program_or_module</span>(<span class="ruby-identifier">container</span>, <span class="ruby-identifier">code</span>,
 355:                               <span class="ruby-identifier">visibility</span>=<span class="ruby-identifier">:public</span>, <span class="ruby-identifier">external</span>=<span class="ruby-keyword kw">nil</span>)
 356:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">container</span>
 357:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">code</span>
 358:     <span class="ruby-identifier">remaining_lines</span> = <span class="ruby-identifier">code</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
 359:     <span class="ruby-identifier">remaining_code</span> = <span class="ruby-node">&quot;#{code}&quot;</span>
 360: 
 361:     <span class="ruby-comment cmt">#</span>
 362:     <span class="ruby-comment cmt"># Parse variables before &quot;contains&quot; in module</span>
 363:     <span class="ruby-comment cmt">#</span>
 364:     <span class="ruby-identifier">level_depth</span> = <span class="ruby-value">0</span>
 365:     <span class="ruby-identifier">before_contains_lines</span> = []
 366:     <span class="ruby-identifier">before_contains_code</span> = <span class="ruby-keyword kw">nil</span>
 367:     <span class="ruby-identifier">before_contains_flag</span> = <span class="ruby-keyword kw">nil</span>
 368:     <span class="ruby-identifier">remaining_lines</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
 369:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">before_contains_flag</span>
 370:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\s*?module\s+\w+\s*?(!.*?)?$/i</span>
 371:           <span class="ruby-identifier">before_contains_flag</span> = <span class="ruby-keyword kw">true</span>
 372:         <span class="ruby-keyword kw">end</span>
 373:       <span class="ruby-keyword kw">else</span>
 374:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\s*?contains\s*?(!.*?)?$/i</span>
 375:         <span class="ruby-identifier">level_depth</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_start?</span>(<span class="ruby-identifier">line</span>)
 376:         <span class="ruby-identifier">level_depth</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_end?</span>(<span class="ruby-identifier">line</span>)
 377:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">level_depth</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>
 378:         <span class="ruby-identifier">before_contains_lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">line</span>
 379:       <span class="ruby-keyword kw">end</span>
 380:     }
 381:     <span class="ruby-identifier">before_contains_code</span> = <span class="ruby-identifier">before_contains_lines</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
 382:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">before_contains_code</span>
 383:       <span class="ruby-identifier">before_contains_code</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/^\s*?interface\s+.*?\s+end\s+interface.*?$/i</span><span class="ruby-identifier">m</span>, <span class="ruby-value str">&quot;&quot;</span>)
 384:       <span class="ruby-identifier">before_contains_code</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/^\s*?type[\s\,]+.*?\s+end\s+type.*?$/i</span><span class="ruby-identifier">m</span>, <span class="ruby-value str">&quot;&quot;</span>)
 385:     <span class="ruby-keyword kw">end</span>
 386: 
 387:     <span class="ruby-comment cmt">#</span>
 388:     <span class="ruby-comment cmt"># Parse global &quot;use&quot;</span>
 389:     <span class="ruby-comment cmt">#</span>
 390:     <span class="ruby-identifier">use_check_code</span> = <span class="ruby-node">&quot;#{before_contains_code}&quot;</span>
 391:     <span class="ruby-identifier">cascaded_modules_list</span> = []
 392:     <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">use_check_code</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\s*?use\s+(\w+)(.*?)(!.*?)?$/i</span>
 393:       <span class="ruby-identifier">use_check_code</span> = <span class="ruby-identifier">$~</span>.<span class="ruby-identifier">pre_match</span>
 394:       <span class="ruby-identifier">use_check_code</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">$~</span>.<span class="ruby-identifier">post_match</span>
 395:       <span class="ruby-identifier">used_mod_name</span> = <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">chomp</span>
 396:       <span class="ruby-identifier">used_list</span> = <span class="ruby-identifier">$2</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>
 397:       <span class="ruby-identifier">used_trailing</span> = <span class="ruby-identifier">$3</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>
 398:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">used_trailing</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/!:nodoc:/</span>
 399:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">container</span>.<span class="ruby-identifier">include_includes?</span>(<span class="ruby-identifier">used_mod_name</span>, <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">ignore_case</span>)
 400:         <span class="ruby-comment cmt"># progress &quot;.&quot; # HACK what stats thingy does this correspond to?</span>
 401:         <span class="ruby-identifier">container</span>.<span class="ruby-identifier">add_include</span> <span class="ruby-constant">Include</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">used_mod_name</span>, <span class="ruby-value str">&quot;&quot;</span>)
 402:       <span class="ruby-keyword kw">end</span>
 403:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span> (<span class="ruby-identifier">used_list</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\,\s*?only\s*?:/i</span> )
 404:         <span class="ruby-identifier">cascaded_modules_list</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\#&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">used_mod_name</span>
 405:       <span class="ruby-keyword kw">end</span>
 406:     <span class="ruby-keyword kw">end</span>
 407: 
 408:     <span class="ruby-comment cmt">#</span>
 409:     <span class="ruby-comment cmt"># Parse public and private, and store information.</span>
 410:     <span class="ruby-comment cmt"># This information is used when &quot;add_method&quot; and</span>
 411:     <span class="ruby-comment cmt"># &quot;set_visibility_for&quot; are called.</span>
 412:     <span class="ruby-comment cmt">#</span>
 413:     <span class="ruby-identifier">visibility_default</span>, <span class="ruby-identifier">visibility_info</span> = 
 414:               <span class="ruby-identifier">parse_visibility</span>(<span class="ruby-identifier">remaining_lines</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>), <span class="ruby-identifier">visibility</span>, <span class="ruby-identifier">container</span>)
 415:     <span class="ruby-ivar">@@public_methods</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">visibility_info</span>
 416:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">visibility_default</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:public</span>
 417:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cascaded_modules_list</span>.<span class="ruby-identifier">empty?</span>
 418:         <span class="ruby-identifier">cascaded_modules</span> = 
 419:           <span class="ruby-constant">Attr</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Cascaded Modules&quot;</span>,
 420:                    <span class="ruby-value str">&quot;Imported modules all of whose components are published again&quot;</span>,
 421:                    <span class="ruby-value str">&quot;&quot;</span>,
 422:                    <span class="ruby-identifier">cascaded_modules_list</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;, &quot;</span>))
 423:         <span class="ruby-identifier">container</span>.<span class="ruby-identifier">add_attribute</span>(<span class="ruby-identifier">cascaded_modules</span>)
 424:       <span class="ruby-keyword kw">end</span>
 425:     <span class="ruby-keyword kw">end</span>
 426: 
 427:     <span class="ruby-comment cmt">#</span>
 428:     <span class="ruby-comment cmt"># Check rename elements</span>
 429:     <span class="ruby-comment cmt">#</span>
 430:     <span class="ruby-identifier">use_check_code</span> = <span class="ruby-node">&quot;#{before_contains_code}&quot;</span>
 431:     <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">use_check_code</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\s*?use\s+(\w+)\s*?\,(.+)$/i</span>
 432:       <span class="ruby-identifier">use_check_code</span> = <span class="ruby-identifier">$~</span>.<span class="ruby-identifier">pre_match</span>
 433:       <span class="ruby-identifier">use_check_code</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">$~</span>.<span class="ruby-identifier">post_match</span>
 434:       <span class="ruby-identifier">used_mod_name</span> = <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">chomp</span>
 435:       <span class="ruby-identifier">used_elements</span> = <span class="ruby-identifier">$2</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/\s*?only\s*?:\s*?/i</span>, <span class="ruby-value str">''</span>)
 436:       <span class="ruby-identifier">used_elements</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;,&quot;</span>).<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">used</span><span class="ruby-operator">|</span>
 437:         <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">/\s*?(\w+)\s*?=&gt;\s*?(\w+)\s*?/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">used</span>
 438:           <span class="ruby-identifier">local</span> = <span class="ruby-identifier">$1</span>
 439:           <span class="ruby-identifier">org</span> = <span class="ruby-identifier">$2</span>
 440:           <span class="ruby-ivar">@@public_methods</span>.<span class="ruby-identifier">collect!</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">pub_meth</span><span class="ruby-operator">|</span>
 441:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">local</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pub_meth</span>[<span class="ruby-value str">&quot;name&quot;</span>] <span class="ruby-operator">||</span>
 442:                 <span class="ruby-identifier">local</span>.<span class="ruby-identifier">upcase</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pub_meth</span>[<span class="ruby-value str">&quot;name&quot;</span>].<span class="ruby-identifier">upcase</span> <span class="ruby-operator">&amp;&amp;</span>
 443:                 <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">ignore_case</span>
 444:               <span class="ruby-identifier">pub_meth</span>[<span class="ruby-value str">&quot;name&quot;</span>] = <span class="ruby-identifier">org</span>
 445:               <span class="ruby-identifier">pub_meth</span>[<span class="ruby-value str">&quot;local_name&quot;</span>] = <span class="ruby-identifier">local</span>
 446:             <span class="ruby-keyword kw">end</span>
 447:             <span class="ruby-identifier">pub_meth</span>
 448:           }
 449:         <span class="ruby-keyword kw">end</span>
 450:       }
 451:     <span class="ruby-keyword kw">end</span>
 452: 
 453:     <span class="ruby-comment cmt">#</span>
 454:     <span class="ruby-comment cmt"># Parse private &quot;use&quot;</span>
 455:     <span class="ruby-comment cmt">#</span>
 456:     <span class="ruby-identifier">use_check_code</span> = <span class="ruby-identifier">remaining_lines</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
 457:     <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">use_check_code</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\s*?use\s+(\w+)(.*?)(!.*?)?$/i</span>
 458:       <span class="ruby-identifier">use_check_code</span> = <span class="ruby-identifier">$~</span>.<span class="ruby-identifier">pre_match</span>
 459:       <span class="ruby-identifier">use_check_code</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">$~</span>.<span class="ruby-identifier">post_match</span>
 460:       <span class="ruby-identifier">used_mod_name</span> = <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">chomp</span>
 461:       <span class="ruby-identifier">used_trailing</span> = <span class="ruby-identifier">$3</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>
 462:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">used_trailing</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/!:nodoc:/</span>
 463:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">container</span>.<span class="ruby-identifier">include_includes?</span>(<span class="ruby-identifier">used_mod_name</span>, <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">ignore_case</span>)
 464:         <span class="ruby-comment cmt"># progress &quot;.&quot; # HACK what stats thingy does this correspond to?</span>
 465:         <span class="ruby-identifier">container</span>.<span class="ruby-identifier">add_include</span> <span class="ruby-constant">Include</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">used_mod_name</span>, <span class="ruby-value str">&quot;&quot;</span>)
 466:       <span class="ruby-keyword kw">end</span>
 467:     <span class="ruby-keyword kw">end</span>
 468: 
 469:     <span class="ruby-identifier">container</span>.<span class="ruby-identifier">each_includes</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">inc</span><span class="ruby-operator">|</span>
 470:       <span class="ruby-constant">TopLevel</span>.<span class="ruby-identifier">all_files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">toplevel</span><span class="ruby-operator">|</span>
 471:         <span class="ruby-identifier">indicated_mod</span> = <span class="ruby-identifier">toplevel</span>.<span class="ruby-identifier">find_symbol</span>(<span class="ruby-identifier">inc</span>.<span class="ruby-identifier">name</span>,
 472:                                              <span class="ruby-keyword kw">nil</span>, <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">ignore_case</span>)
 473:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">indicated_mod</span>
 474:           <span class="ruby-identifier">indicated_name</span> = <span class="ruby-identifier">indicated_mod</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">file_relative_name</span>
 475:           <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">container</span>.<span class="ruby-identifier">include_requires?</span>(<span class="ruby-identifier">indicated_name</span>, <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">ignore_case</span>)
 476:             <span class="ruby-identifier">container</span>.<span class="ruby-identifier">add_require</span>(<span class="ruby-constant">Require</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">indicated_name</span>, <span class="ruby-value str">&quot;&quot;</span>))
 477:           <span class="ruby-keyword kw">end</span>
 478:           <span class="ruby-keyword kw">break</span>
 479:         <span class="ruby-keyword kw">end</span>
 480:       <span class="ruby-keyword kw">end</span>
 481:     }
 482: 
 483:     <span class="ruby-comment cmt">#</span>
 484:     <span class="ruby-comment cmt"># Parse derived-types definitions</span>
 485:     <span class="ruby-comment cmt">#</span>
 486:     <span class="ruby-identifier">derived_types_comment</span> = <span class="ruby-value str">&quot;&quot;</span>
 487:     <span class="ruby-identifier">remaining_code</span> = <span class="ruby-identifier">remaining_lines</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
 488:     <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">remaining_code</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\s*?
 489:                                   type[\s\,]+(public|private)?\s*?(::)?\s*?
 490:                                   (\w+)\s*?(!.*?)?$
 491:                                   (.*?)
 492:                                   ^\s*?end\s+type.*?$
 493:                             /i</span><span class="ruby-identifier">mx</span>
 494:       <span class="ruby-identifier">remaining_code</span> = <span class="ruby-identifier">$~</span>.<span class="ruby-identifier">pre_match</span>
 495:       <span class="ruby-identifier">remaining_code</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">$~</span>.<span class="ruby-identifier">post_match</span>
 496:       <span class="ruby-identifier">typename</span> = <span class="ruby-identifier">$3</span>.<span class="ruby-identifier">chomp</span>.<span class="ruby-identifier">strip</span>
 497:       <span class="ruby-identifier">type_elements</span> = <span class="ruby-identifier">$5</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>
 498:       <span class="ruby-identifier">type_code</span> = <span class="ruby-identifier">remove_empty_head_lines</span>(<span class="ruby-identifier">$&amp;</span>)
 499:       <span class="ruby-identifier">type_trailing</span> = <span class="ruby-identifier">find_comments</span>(<span class="ruby-identifier">$4</span>)
 500:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">type_trailing</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^:nodoc:/</span>
 501:       <span class="ruby-identifier">type_visibility</span> = <span class="ruby-identifier">$1</span>
 502:       <span class="ruby-identifier">type_comment</span> = <span class="ruby-constant">COMMENTS_ARE_UPPER</span> <span class="ruby-value">? </span>
 503:         <span class="ruby-identifier">find_comments</span>(<span class="ruby-identifier">$~</span>.<span class="ruby-identifier">pre_match</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;\n&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">type_trailing</span> <span class="ruby-operator">:</span>
 504:           <span class="ruby-identifier">type_trailing</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;\n&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">find_comments</span>(<span class="ruby-identifier">type_code</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/^.*$\n/i</span>, <span class="ruby-value str">''</span>))
 505:       <span class="ruby-identifier">type_element_visibility_public</span> = <span class="ruby-keyword kw">true</span>
 506:       <span class="ruby-identifier">type_code</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;\n&quot;</span>).<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
 507:         <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">/^\s*?private\s*?$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">line</span>
 508:           <span class="ruby-identifier">type_element_visibility_public</span> = <span class="ruby-keyword kw">nil</span>
 509:           <span class="ruby-keyword kw">break</span>
 510:         <span class="ruby-keyword kw">end</span>
 511:       } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">type_code</span>
 512: 
 513:       <span class="ruby-identifier">args_comment</span> = <span class="ruby-value str">&quot;&quot;</span>
 514:       <span class="ruby-identifier">type_args_info</span> = <span class="ruby-keyword kw">nil</span>
 515: 
 516:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">show_all</span>
 517:         <span class="ruby-identifier">args_comment</span> = <span class="ruby-identifier">find_arguments</span>(<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">type_code</span>, <span class="ruby-keyword kw">true</span>)
 518:       <span class="ruby-keyword kw">else</span>
 519:         <span class="ruby-identifier">type_public_args_list</span> = []
 520:         <span class="ruby-identifier">type_args_info</span> = <span class="ruby-identifier">definition_info</span>(<span class="ruby-identifier">type_code</span>)
 521:         <span class="ruby-identifier">type_args_info</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span>
 522:           <span class="ruby-identifier">arg_is_public</span> = <span class="ruby-identifier">type_element_visibility_public</span>
 523:           <span class="ruby-identifier">arg_is_public</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">include_attr?</span>(<span class="ruby-value str">&quot;public&quot;</span>)
 524:           <span class="ruby-identifier">arg_is_public</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">include_attr?</span>(<span class="ruby-value str">&quot;private&quot;</span>)
 525:           <span class="ruby-identifier">type_public_args_list</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">varname</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arg_is_public</span>
 526:         }
 527:         <span class="ruby-identifier">args_comment</span> = <span class="ruby-identifier">find_arguments</span>(<span class="ruby-identifier">type_public_args_list</span>, <span class="ruby-identifier">type_code</span>)
 528:       <span class="ruby-keyword kw">end</span>
 529: 
 530:       <span class="ruby-identifier">type</span> = <span class="ruby-constant">AnyMethod</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;type #{typename}&quot;</span>, <span class="ruby-identifier">typename</span>)
 531:       <span class="ruby-identifier">type</span>.<span class="ruby-identifier">singleton</span> = <span class="ruby-keyword kw">false</span>
 532:       <span class="ruby-identifier">type</span>.<span class="ruby-identifier">params</span> = <span class="ruby-value str">&quot;&quot;</span>
 533:       <span class="ruby-identifier">type</span>.<span class="ruby-identifier">comment</span> = <span class="ruby-value str">&quot;&lt;b&gt;&lt;em&gt; Derived Type &lt;/em&gt;&lt;/b&gt; :: &lt;tt&gt;&lt;/tt&gt;\n&quot;</span>
 534:       <span class="ruby-identifier">type</span>.<span class="ruby-identifier">comment</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">args_comment</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args_comment</span>
 535:       <span class="ruby-identifier">type</span>.<span class="ruby-identifier">comment</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">type_comment</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">type_comment</span>
 536: 
 537:       <span class="ruby-ivar">@stats</span>.<span class="ruby-identifier">add_method</span> <span class="ruby-identifier">type</span>
 538: 
 539:       <span class="ruby-identifier">container</span>.<span class="ruby-identifier">add_method</span> <span class="ruby-identifier">type</span>
 540: 
 541:       <span class="ruby-identifier">set_visibility</span>(<span class="ruby-identifier">container</span>, <span class="ruby-identifier">typename</span>, <span class="ruby-identifier">visibility_default</span>, <span class="ruby-ivar">@@public_methods</span>)
 542: 
 543:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">type_visibility</span>
 544:         <span class="ruby-identifier">type_visibility</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\s/</span>,<span class="ruby-value str">''</span>)
 545:         <span class="ruby-identifier">type_visibility</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\,/</span>,<span class="ruby-value str">''</span>)
 546:         <span class="ruby-identifier">type_visibility</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/:/</span>,<span class="ruby-value str">''</span>)
 547:         <span class="ruby-identifier">type_visibility</span>.<span class="ruby-identifier">downcase!</span>
 548:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">type_visibility</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;public&quot;</span>
 549:           <span class="ruby-identifier">container</span>.<span class="ruby-identifier">set_visibility_for</span>([<span class="ruby-identifier">typename</span>], <span class="ruby-identifier">:public</span>)
 550:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">type_visibility</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;private&quot;</span>
 551:           <span class="ruby-identifier">container</span>.<span class="ruby-identifier">set_visibility_for</span>([<span class="ruby-identifier">typename</span>], <span class="ruby-identifier">:private</span>)
 552:         <span class="ruby-keyword kw">end</span>
 553:       <span class="ruby-keyword kw">end</span>
 554: 
 555:       <span class="ruby-identifier">check_public_methods</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">container</span>.<span class="ruby-identifier">name</span>)
 556: 
 557:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">show_all</span>
 558:         <span class="ruby-identifier">derived_types_comment</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;, &quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">derived_types_comment</span>.<span class="ruby-identifier">empty?</span>
 559:         <span class="ruby-identifier">derived_types_comment</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">typename</span>
 560:       <span class="ruby-keyword kw">else</span>
 561:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">visibility</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:public</span>
 562:         <span class="ruby-identifier">derived_types_comment</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;, &quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">derived_types_comment</span>.<span class="ruby-identifier">empty?</span>
 563:         <span class="ruby-identifier">derived_types_comment</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">typename</span>
 564:         <span class="ruby-keyword kw">end</span>
 565:       <span class="ruby-keyword kw">end</span>
 566: 
 567:     <span class="ruby-keyword kw">end</span>
 568: 
 569:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">derived_types_comment</span>.<span class="ruby-identifier">empty?</span>
 570:       <span class="ruby-identifier">derived_types_table</span> = 
 571:         <span class="ruby-constant">Attr</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Derived Types&quot;</span>, <span class="ruby-value str">&quot;Derived_Types&quot;</span>, <span class="ruby-value str">&quot;&quot;</span>, 
 572:                  <span class="ruby-identifier">derived_types_comment</span>)
 573:       <span class="ruby-identifier">container</span>.<span class="ruby-identifier">add_attribute</span>(<span class="ruby-identifier">derived_types_table</span>)
 574:     <span class="ruby-keyword kw">end</span>
 575: 
 576:     <span class="ruby-comment cmt">#</span>
 577:     <span class="ruby-comment cmt"># move interface scope</span>
 578:     <span class="ruby-comment cmt">#</span>
 579:     <span class="ruby-identifier">interface_code</span> = <span class="ruby-value str">&quot;&quot;</span>
 580:     <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">remaining_code</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\s*?
 581:                                  interface(
 582:                                             \s+\w+                      |
 583:                                             \s+operator\s*?\(.*?\)       |
 584:                                             \s+assignment\s*?\(\s*?=\s*?\)
 585:                                           )?\s*?$
 586:                                  (.*?)
 587:                                  ^\s*?end\s+interface.*?$
 588:                             /i</span><span class="ruby-identifier">mx</span>
 589:       <span class="ruby-identifier">interface_code</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">remove_empty_head_lines</span>(<span class="ruby-identifier">$&amp;</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;\n&quot;</span>
 590:       <span class="ruby-identifier">remaining_code</span> = <span class="ruby-identifier">$~</span>.<span class="ruby-identifier">pre_match</span>
 591:       <span class="ruby-identifier">remaining_code</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">$~</span>.<span class="ruby-identifier">post_match</span>
 592:     <span class="ruby-keyword kw">end</span>
 593: 
 594:     <span class="ruby-comment cmt">#</span>
 595:     <span class="ruby-comment cmt"># Parse global constants or variables in modules</span>
 596:     <span class="ruby-comment cmt">#</span>
 597:     <span class="ruby-identifier">const_var_defs</span> = <span class="ruby-identifier">definition_info</span>(<span class="ruby-identifier">before_contains_code</span>)
 598:     <span class="ruby-identifier">const_var_defs</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">defitem</span><span class="ruby-operator">|</span>
 599:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">defitem</span>.<span class="ruby-identifier">nodoc</span>
 600:       <span class="ruby-identifier">const_or_var_type</span> = <span class="ruby-value str">&quot;Variable&quot;</span>
 601:       <span class="ruby-identifier">const_or_var_progress</span> = <span class="ruby-value str">&quot;v&quot;</span>
 602:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">defitem</span>.<span class="ruby-identifier">include_attr?</span>(<span class="ruby-value str">&quot;parameter&quot;</span>)
 603:         <span class="ruby-identifier">const_or_var_type</span> = <span class="ruby-value str">&quot;Constant&quot;</span>
 604:         <span class="ruby-identifier">const_or_var_progress</span> = <span class="ruby-value str">&quot;c&quot;</span>
 605:       <span class="ruby-keyword kw">end</span>
 606:       <span class="ruby-identifier">const_or_var</span> = <span class="ruby-constant">AnyMethod</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">const_or_var_type</span>, <span class="ruby-identifier">defitem</span>.<span class="ruby-identifier">varname</span>)
 607:       <span class="ruby-identifier">const_or_var</span>.<span class="ruby-identifier">singleton</span> = <span class="ruby-keyword kw">false</span>
 608:       <span class="ruby-identifier">const_or_var</span>.<span class="ruby-identifier">params</span> = <span class="ruby-value str">&quot;&quot;</span>
 609:       <span class="ruby-identifier">self_comment</span> = <span class="ruby-identifier">find_arguments</span>([<span class="ruby-identifier">defitem</span>.<span class="ruby-identifier">varname</span>], <span class="ruby-identifier">before_contains_code</span>)
 610:       <span class="ruby-identifier">const_or_var</span>.<span class="ruby-identifier">comment</span> = <span class="ruby-value str">&quot;&lt;b&gt;&lt;em&gt;&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">const_or_var_type</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;&lt;/em&gt;&lt;/b&gt; :: &lt;tt&gt;&lt;/tt&gt;\n&quot;</span>
 611:       <span class="ruby-identifier">const_or_var</span>.<span class="ruby-identifier">comment</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">self_comment</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">self_comment</span>
 612: 
 613:       <span class="ruby-ivar">@stats</span>.<span class="ruby-identifier">add_method</span> <span class="ruby-identifier">const_or_var_progress</span>
 614: 
 615:       <span class="ruby-identifier">container</span>.<span class="ruby-identifier">add_method</span> <span class="ruby-identifier">const_or_var</span>
 616: 
 617:       <span class="ruby-identifier">set_visibility</span>(<span class="ruby-identifier">container</span>, <span class="ruby-identifier">defitem</span>.<span class="ruby-identifier">varname</span>, <span class="ruby-identifier">visibility_default</span>, <span class="ruby-ivar">@@public_methods</span>)
 618: 
 619:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">defitem</span>.<span class="ruby-identifier">include_attr?</span>(<span class="ruby-value str">&quot;public&quot;</span>)
 620:         <span class="ruby-identifier">container</span>.<span class="ruby-identifier">set_visibility_for</span>([<span class="ruby-identifier">defitem</span>.<span class="ruby-identifier">varname</span>], <span class="ruby-identifier">:public</span>)
 621:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">defitem</span>.<span class="ruby-identifier">include_attr?</span>(<span class="ruby-value str">&quot;private&quot;</span>)
 622:         <span class="ruby-identifier">container</span>.<span class="ruby-identifier">set_visibility_for</span>([<span class="ruby-identifier">defitem</span>.<span class="ruby-identifier">varname</span>], <span class="ruby-identifier">:private</span>)
 623:       <span class="ruby-keyword kw">end</span>
 624: 
 625:       <span class="ruby-identifier">check_public_methods</span>(<span class="ruby-identifier">const_or_var</span>, <span class="ruby-identifier">container</span>.<span class="ruby-identifier">name</span>)
 626: 
 627:     } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">const_var_defs</span>
 628: 
 629:     <span class="ruby-identifier">remaining_lines</span> = <span class="ruby-identifier">remaining_code</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
 630: 
 631:     <span class="ruby-comment cmt"># &quot;subroutine&quot; or &quot;function&quot; parts are parsed (new)</span>
 632:     <span class="ruby-comment cmt">#</span>
 633:     <span class="ruby-identifier">level_depth</span> = <span class="ruby-value">0</span>
 634:     <span class="ruby-identifier">block_searching_flag</span> = <span class="ruby-keyword kw">nil</span>
 635:     <span class="ruby-identifier">block_searching_lines</span> = []
 636:     <span class="ruby-identifier">pre_comment</span> = []
 637:     <span class="ruby-identifier">procedure_trailing</span> = <span class="ruby-value str">&quot;&quot;</span>
 638:     <span class="ruby-identifier">procedure_name</span> = <span class="ruby-value str">&quot;&quot;</span>
 639:     <span class="ruby-identifier">procedure_params</span> = <span class="ruby-value str">&quot;&quot;</span>
 640:     <span class="ruby-identifier">procedure_prefix</span> = <span class="ruby-value str">&quot;&quot;</span>
 641:     <span class="ruby-identifier">procedure_result_arg</span> = <span class="ruby-value str">&quot;&quot;</span>
 642:     <span class="ruby-identifier">procedure_type</span> = <span class="ruby-value str">&quot;&quot;</span>
 643:     <span class="ruby-identifier">contains_lines</span> = []
 644:     <span class="ruby-identifier">contains_flag</span> = <span class="ruby-keyword kw">nil</span>
 645:     <span class="ruby-identifier">remaining_lines</span>.<span class="ruby-identifier">collect!</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
 646:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">block_searching_flag</span>
 647:         <span class="ruby-comment cmt"># subroutine</span>
 648:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\s*?
 649:                          (recursive|pure|elemental)?\s*?
 650:                          subroutine\s+(\w+)\s*?(\(.*?\))?\s*?(!.*?)?$
 651:                    /i</span><span class="ruby-identifier">x</span>
 652:           <span class="ruby-identifier">block_searching_flag</span> = <span class="ruby-identifier">:subroutine</span>
 653:           <span class="ruby-identifier">block_searching_lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">line</span>
 654: 
 655:           <span class="ruby-identifier">procedure_name</span> = <span class="ruby-identifier">$2</span>.<span class="ruby-identifier">chomp</span>.<span class="ruby-identifier">strip</span>
 656:           <span class="ruby-identifier">procedure_params</span> = <span class="ruby-identifier">$3</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>
 657:           <span class="ruby-identifier">procedure_prefix</span> = <span class="ruby-identifier">$1</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>
 658:           <span class="ruby-identifier">procedure_trailing</span> = <span class="ruby-identifier">$4</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;!&quot;</span>
 659:           <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">false</span>
 660: 
 661:         <span class="ruby-comment cmt"># function</span>
 662:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\s*?
 663:                        (recursive|pure|elemental)?\s*?
 664:                        (
 665:                            character\s*?(\([\w\s\=\(\)\*]+?\))?\s+
 666:                          | type\s*?\([\w\s]+?\)\s+
 667:                          | integer\s*?(\([\w\s\=\(\)\*]+?\))?\s+
 668:                          | real\s*?(\([\w\s\=\(\)\*]+?\))?\s+
 669:                          | double\s+precision\s+
 670:                          | logical\s*?(\([\w\s\=\(\)\*]+?\))?\s+
 671:                          | complex\s*?(\([\w\s\=\(\)\*]+?\))?\s+
 672:                        )?
 673:                        function\s+(\w+)\s*?
 674:                        (\(.*?\))?(\s+result\((.*?)\))?\s*?(!.*?)?$
 675:                       /i</span><span class="ruby-identifier">x</span>
 676:           <span class="ruby-identifier">block_searching_flag</span> = <span class="ruby-identifier">:function</span>
 677:           <span class="ruby-identifier">block_searching_lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">line</span>
 678: 
 679:           <span class="ruby-identifier">procedure_prefix</span> = <span class="ruby-identifier">$1</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>
 680:           <span class="ruby-identifier">procedure_type</span> = <span class="ruby-identifier">$2</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">$2</span>.<span class="ruby-identifier">chomp</span>.<span class="ruby-identifier">strip</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>
 681:           <span class="ruby-identifier">procedure_name</span> = <span class="ruby-identifier">$8</span>.<span class="ruby-identifier">chomp</span>.<span class="ruby-identifier">strip</span>
 682:           <span class="ruby-identifier">procedure_params</span> = <span class="ruby-identifier">$9</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>
 683:           <span class="ruby-identifier">procedure_result_arg</span> = <span class="ruby-identifier">$11</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">$11</span>.<span class="ruby-identifier">chomp</span>.<span class="ruby-identifier">strip</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">procedure_name</span>
 684:           <span class="ruby-identifier">procedure_trailing</span> = <span class="ruby-identifier">$12</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;!&quot;</span>
 685:           <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">false</span>
 686:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\s*?!\s?(.*)/</span>
 687:           <span class="ruby-identifier">pre_comment</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">line</span>
 688:           <span class="ruby-keyword kw">next</span> <span class="ruby-identifier">line</span>
 689:         <span class="ruby-keyword kw">else</span>
 690:           <span class="ruby-identifier">pre_comment</span> = []
 691:           <span class="ruby-keyword kw">next</span> <span class="ruby-identifier">line</span>
 692:         <span class="ruby-keyword kw">end</span>
 693:       <span class="ruby-keyword kw">end</span>
 694:       <span class="ruby-identifier">contains_flag</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\s*?contains\s*?(!.*?)?$/</span>
 695:       <span class="ruby-identifier">block_searching_lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">line</span>
 696:       <span class="ruby-identifier">contains_lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">line</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">contains_flag</span>
 697: 
 698:       <span class="ruby-identifier">level_depth</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_start?</span>(<span class="ruby-identifier">line</span>)
 699:       <span class="ruby-identifier">level_depth</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_end?</span>(<span class="ruby-identifier">line</span>)
 700:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">level_depth</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span>
 701:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">false</span>
 702:       <span class="ruby-keyword kw">end</span>
 703: 
 704:       <span class="ruby-comment cmt"># &quot;procedure_code&quot; is formatted.</span>
 705:       <span class="ruby-comment cmt"># &quot;:nodoc:&quot; flag is checked.</span>
 706:       <span class="ruby-comment cmt">#</span>
 707:       <span class="ruby-identifier">procedure_code</span> = <span class="ruby-identifier">block_searching_lines</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
 708:       <span class="ruby-identifier">procedure_code</span> = <span class="ruby-identifier">remove_empty_head_lines</span>(<span class="ruby-identifier">procedure_code</span>)
 709:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">procedure_trailing</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^!:nodoc:/</span>
 710:         <span class="ruby-comment cmt"># next loop to search next block</span>
 711:         <span class="ruby-identifier">level_depth</span> = <span class="ruby-value">0</span>
 712:         <span class="ruby-identifier">block_searching_flag</span> = <span class="ruby-keyword kw">nil</span>
 713:         <span class="ruby-identifier">block_searching_lines</span> = []
 714:         <span class="ruby-identifier">pre_comment</span> = []
 715:         <span class="ruby-identifier">procedure_trailing</span> = <span class="ruby-value str">&quot;&quot;</span>
 716:         <span class="ruby-identifier">procedure_name</span> = <span class="ruby-value str">&quot;&quot;</span>
 717:         <span class="ruby-identifier">procedure_params</span> = <span class="ruby-value str">&quot;&quot;</span>
 718:         <span class="ruby-identifier">procedure_prefix</span> = <span class="ruby-value str">&quot;&quot;</span>
 719:         <span class="ruby-identifier">procedure_result_arg</span> = <span class="ruby-value str">&quot;&quot;</span>
 720:         <span class="ruby-identifier">procedure_type</span> = <span class="ruby-value str">&quot;&quot;</span>
 721:         <span class="ruby-identifier">contains_lines</span> = []
 722:         <span class="ruby-identifier">contains_flag</span> = <span class="ruby-keyword kw">nil</span>
 723:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">false</span>
 724:       <span class="ruby-keyword kw">end</span>
 725: 
 726:       <span class="ruby-comment cmt"># AnyMethod is created, and added to container</span>
 727:       <span class="ruby-comment cmt">#</span>
 728:       <span class="ruby-identifier">subroutine_function</span> = <span class="ruby-keyword kw">nil</span>
 729:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_searching_flag</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:subroutine</span>
 730:         <span class="ruby-identifier">subroutine_prefix</span>   = <span class="ruby-identifier">procedure_prefix</span>
 731:         <span class="ruby-identifier">subroutine_name</span>     = <span class="ruby-identifier">procedure_name</span>
 732:         <span class="ruby-identifier">subroutine_params</span>   = <span class="ruby-identifier">procedure_params</span>
 733:         <span class="ruby-identifier">subroutine_trailing</span> = <span class="ruby-identifier">procedure_trailing</span>
 734:         <span class="ruby-identifier">subroutine_code</span>     = <span class="ruby-identifier">procedure_code</span>
 735: 
 736:         <span class="ruby-identifier">subroutine_comment</span> = <span class="ruby-constant">COMMENTS_ARE_UPPER</span> <span class="ruby-value">? </span>
 737:           <span class="ruby-identifier">pre_comment</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;\n&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">subroutine_trailing</span> <span class="ruby-operator">:</span> 
 738:             <span class="ruby-identifier">subroutine_trailing</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;\n&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">subroutine_code</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/^.*$\n/i</span>, <span class="ruby-value str">''</span>)
 739:         <span class="ruby-identifier">subroutine</span> = <span class="ruby-constant">AnyMethod</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;subroutine&quot;</span>, <span class="ruby-identifier">subroutine_name</span>)
 740:         <span class="ruby-identifier">parse_subprogram</span>(<span class="ruby-identifier">subroutine</span>, <span class="ruby-identifier">subroutine_params</span>,
 741:                          <span class="ruby-identifier">subroutine_comment</span>, <span class="ruby-identifier">subroutine_code</span>,
 742:                          <span class="ruby-identifier">before_contains_code</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">subroutine_prefix</span>)
 743: 
 744:         <span class="ruby-ivar">@stats</span>.<span class="ruby-identifier">add_method</span> <span class="ruby-identifier">subroutine</span>
 745: 
 746:         <span class="ruby-identifier">container</span>.<span class="ruby-identifier">add_method</span> <span class="ruby-identifier">subroutine</span>
 747:         <span class="ruby-identifier">subroutine_function</span> = <span class="ruby-identifier">subroutine</span>
 748: 
 749:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">block_searching_flag</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:function</span>
 750:         <span class="ruby-identifier">function_prefix</span>     = <span class="ruby-identifier">procedure_prefix</span>
 751:         <span class="ruby-identifier">function_type</span>       = <span class="ruby-identifier">procedure_type</span>
 752:         <span class="ruby-identifier">function_name</span>       = <span class="ruby-identifier">procedure_name</span>
 753:         <span class="ruby-identifier">function_params_org</span> = <span class="ruby-identifier">procedure_params</span>
 754:         <span class="ruby-identifier">function_result_arg</span> = <span class="ruby-identifier">procedure_result_arg</span>
 755:         <span class="ruby-identifier">function_trailing</span>   = <span class="ruby-identifier">procedure_trailing</span>
 756:         <span class="ruby-identifier">function_code_org</span>   = <span class="ruby-identifier">procedure_code</span>
 757: 
 758:         <span class="ruby-identifier">function_comment</span> = <span class="ruby-constant">COMMENTS_ARE_UPPER</span> <span class="ruby-value">?
 759: </span>          <span class="ruby-identifier">pre_comment</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;\n&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">function_trailing</span> <span class="ruby-operator">:</span>
 760:             <span class="ruby-identifier">function_trailing</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;\n &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">function_code_org</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/^.*$\n/i</span>, <span class="ruby-value str">''</span>)
 761: 
 762:         <span class="ruby-identifier">function_code</span> = <span class="ruby-node">&quot;#{function_code_org}&quot;</span>
 763:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">function_type</span>
 764:           <span class="ruby-identifier">function_code</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">function_type</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; :: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">function_result_arg</span>
 765:         <span class="ruby-keyword kw">end</span>
 766: 
 767:         <span class="ruby-identifier">function_params</span> =
 768:           <span class="ruby-identifier">function_params_org</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/^\(/</span>, <span class="ruby-node">&quot;\(#{function_result_arg}, &quot;</span>)
 769: 
 770:         <span class="ruby-identifier">function</span> = <span class="ruby-constant">AnyMethod</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;function&quot;</span>, <span class="ruby-identifier">function_name</span>)
 771:         <span class="ruby-identifier">parse_subprogram</span>(<span class="ruby-identifier">function</span>, <span class="ruby-identifier">function_params</span>,
 772:                          <span class="ruby-identifier">function_comment</span>, <span class="ruby-identifier">function_code</span>,
 773:                          <span class="ruby-identifier">before_contains_code</span>, <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">function_prefix</span>)
 774: 
 775:         <span class="ruby-comment cmt"># Specific modification due to function</span>
 776:         <span class="ruby-identifier">function</span>.<span class="ruby-identifier">params</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-node">/\(\s*?#{function_result_arg}\s*?,\s*?/</span>, <span class="ruby-value str">&quot;\( &quot;</span>)
 777:         <span class="ruby-identifier">function</span>.<span class="ruby-identifier">params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot; result(&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">function_result_arg</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;)&quot;</span>
 778:         <span class="ruby-identifier">function</span>.<span class="ruby-identifier">start_collecting_tokens</span>
 779:         <span class="ruby-identifier">function</span>.<span class="ruby-identifier">add_token</span> <span class="ruby-constant">Token</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">1</span>,<span class="ruby-value">1</span>).<span class="ruby-identifier">set_text</span>(<span class="ruby-identifier">function_code_org</span>)
 780: 
 781:         <span class="ruby-ivar">@stats</span>.<span class="ruby-identifier">add_method</span> <span class="ruby-identifier">function</span>
 782: 
 783:         <span class="ruby-identifier">container</span>.<span class="ruby-identifier">add_method</span> <span class="ruby-identifier">function</span>
 784:         <span class="ruby-identifier">subroutine_function</span> = <span class="ruby-identifier">function</span>
 785: 
 786:       <span class="ruby-keyword kw">end</span>
 787: 
 788:       <span class="ruby-comment cmt"># The visibility of procedure is specified</span>
 789:       <span class="ruby-comment cmt">#</span>
 790:       <span class="ruby-identifier">set_visibility</span>(<span class="ruby-identifier">container</span>, <span class="ruby-identifier">procedure_name</span>, 
 791:                      <span class="ruby-identifier">visibility_default</span>, <span class="ruby-ivar">@@public_methods</span>)
 792: 
 793:       <span class="ruby-comment cmt"># The alias for this procedure from external modules</span>
 794:       <span class="ruby-comment cmt">#</span>
 795:       <span class="ruby-identifier">check_external_aliases</span>(<span class="ruby-identifier">procedure_name</span>,
 796:                              <span class="ruby-identifier">subroutine_function</span>.<span class="ruby-identifier">params</span>,
 797:                              <span class="ruby-identifier">subroutine_function</span>.<span class="ruby-identifier">comment</span>, <span class="ruby-identifier">subroutine_function</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">external</span>
 798:       <span class="ruby-identifier">check_public_methods</span>(<span class="ruby-identifier">subroutine_function</span>, <span class="ruby-identifier">container</span>.<span class="ruby-identifier">name</span>)
 799: 
 800: 
 801:       <span class="ruby-comment cmt"># contains_lines are parsed as private procedures</span>
 802:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">contains_flag</span>
 803:         <span class="ruby-identifier">parse_program_or_module</span>(<span class="ruby-identifier">container</span>,
 804:                                 <span class="ruby-identifier">contains_lines</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>), <span class="ruby-identifier">:private</span>)
 805:       <span class="ruby-keyword kw">end</span>
 806: 
 807:       <span class="ruby-comment cmt"># next loop to search next block</span>
 808:       <span class="ruby-identifier">level_depth</span> = <span class="ruby-value">0</span>
 809:       <span class="ruby-identifier">block_searching_flag</span> = <span class="ruby-keyword kw">nil</span>
 810:       <span class="ruby-identifier">block_searching_lines</span> = []
 811:       <span class="ruby-identifier">pre_comment</span> = []
 812:       <span class="ruby-identifier">procedure_trailing</span> = <span class="ruby-value str">&quot;&quot;</span>
 813:       <span class="ruby-identifier">procedure_name</span> = <span class="ruby-value str">&quot;&quot;</span>
 814:       <span class="ruby-identifier">procedure_params</span> = <span class="ruby-value str">&quot;&quot;</span>
 815:       <span class="ruby-identifier">procedure_prefix</span> = <span class="ruby-value str">&quot;&quot;</span>
 816:       <span class="ruby-identifier">procedure_result_arg</span> = <span class="ruby-value str">&quot;&quot;</span>
 817:       <span class="ruby-identifier">contains_lines</span> = []
 818:       <span class="ruby-identifier">contains_flag</span> = <span class="ruby-keyword kw">nil</span>
 819:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">false</span>
 820:     } <span class="ruby-comment cmt"># End of remaining_lines.collect!{|line|</span>
 821: 
 822:     <span class="ruby-comment cmt"># Array remains_lines is converted to String remains_code again</span>
 823:     <span class="ruby-comment cmt">#</span>
 824:     <span class="ruby-identifier">remaining_code</span> = <span class="ruby-identifier">remaining_lines</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
 825: 
 826:     <span class="ruby-comment cmt">#</span>
 827:     <span class="ruby-comment cmt"># Parse interface</span>
 828:     <span class="ruby-comment cmt">#</span>
 829:     <span class="ruby-identifier">interface_scope</span> = <span class="ruby-keyword kw">false</span>
 830:     <span class="ruby-identifier">generic_name</span> = <span class="ruby-value str">&quot;&quot;</span>
 831:     <span class="ruby-identifier">interface_code</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;\n&quot;</span>).<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
 832:       <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">/^\s*?
 833:                interface(
 834:                           \s+\w+|
 835:                           \s+operator\s*?\(.*?\)|
 836:                           \s+assignment\s*?\(\s*?=\s*?\)
 837:                         )?
 838:                \s*?(!.*?)?$
 839:          /i</span><span class="ruby-identifier">x</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">line</span>
 840:         <span class="ruby-identifier">generic_name</span> = <span class="ruby-identifier">$1</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">chomp</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>
 841:         <span class="ruby-identifier">interface_trailing</span> = <span class="ruby-identifier">$2</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;!&quot;</span>
 842:         <span class="ruby-identifier">interface_scope</span> = <span class="ruby-keyword kw">true</span>
 843:         <span class="ruby-identifier">interface_scope</span> = <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">interface_trailing</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/!:nodoc:/</span>
 844: <span class="ruby-comment cmt">#        if generic_name =~ /operator\s*?\((.*?)\)/i</span>
 845: <span class="ruby-comment cmt">#          operator_name = $1</span>
 846: <span class="ruby-comment cmt">#          if operator_name &amp;&amp; !operator_name.empty?</span>
 847: <span class="ruby-comment cmt">#            generic_name = &quot;#{operator_name}&quot;</span>
 848: <span class="ruby-comment cmt">#          end</span>
 849: <span class="ruby-comment cmt">#        end</span>
 850: <span class="ruby-comment cmt">#        if generic_name =~ /assignment\s*?\((.*?)\)/i</span>
 851: <span class="ruby-comment cmt">#          assignment_name = $1</span>
 852: <span class="ruby-comment cmt">#          if assignment_name &amp;&amp; !assignment_name.empty?</span>
 853: <span class="ruby-comment cmt">#            generic_name = &quot;#{assignment_name}&quot;</span>
 854: <span class="ruby-comment cmt">#          end</span>
 855: <span class="ruby-comment cmt">#        end</span>
 856:       <span class="ruby-keyword kw">end</span>
 857:       <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">/^\s*?end\s+interface/i</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">line</span>
 858:         <span class="ruby-identifier">interface_scope</span> = <span class="ruby-keyword kw">false</span>
 859:         <span class="ruby-identifier">generic_name</span> = <span class="ruby-keyword kw">nil</span>
 860:       <span class="ruby-keyword kw">end</span>
 861:       <span class="ruby-comment cmt"># internal alias</span>
 862:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">interface_scope</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-regexp re">/^\s*?module\s+procedure\s+(.*?)(!.*?)?$/i</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">line</span>
 863:         <span class="ruby-identifier">procedures</span> = <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">chomp</span>
 864:         <span class="ruby-identifier">procedures_trailing</span> = <span class="ruby-identifier">$2</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;!&quot;</span>
 865:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">procedures_trailing</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/!:nodoc:/</span>
 866:         <span class="ruby-identifier">procedures</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;,&quot;</span>).<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">proc</span><span class="ruby-operator">|</span>
 867:           <span class="ruby-identifier">proc</span>.<span class="ruby-identifier">strip!</span>
 868:           <span class="ruby-identifier">proc</span>.<span class="ruby-identifier">chomp!</span>
 869:           <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">generic_name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">proc</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">generic_name</span>
 870:           <span class="ruby-identifier">old_meth</span> = <span class="ruby-identifier">container</span>.<span class="ruby-identifier">find_symbol</span>(<span class="ruby-identifier">proc</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">ignore_case</span>)
 871:           <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">old_meth</span>
 872:           <span class="ruby-identifier">nolink</span> = <span class="ruby-identifier">old_meth</span>.<span class="ruby-identifier">visibility</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:private</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>
 873:           <span class="ruby-identifier">nolink</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">show_all</span>
 874:           <span class="ruby-identifier">new_meth</span> = 
 875:              <span class="ruby-identifier">initialize_external_method</span>(<span class="ruby-identifier">generic_name</span>, <span class="ruby-identifier">proc</span>, 
 876:                                         <span class="ruby-identifier">old_meth</span>.<span class="ruby-identifier">params</span>, <span class="ruby-keyword kw">nil</span>, 
 877:                                         <span class="ruby-identifier">old_meth</span>.<span class="ruby-identifier">comment</span>, 
 878:                                         <span class="ruby-identifier">old_meth</span>.<span class="ruby-identifier">clone</span>.<span class="ruby-identifier">token_stream</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">text</span>, 
 879:                                         <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">nolink</span>)
 880:           <span class="ruby-identifier">new_meth</span>.<span class="ruby-identifier">singleton</span> = <span class="ruby-identifier">old_meth</span>.<span class="ruby-identifier">singleton</span>
 881: 
 882:           <span class="ruby-ivar">@stats</span>.<span class="ruby-identifier">add_method</span> <span class="ruby-identifier">new_meth</span>
 883: 
 884:           <span class="ruby-identifier">container</span>.<span class="ruby-identifier">add_method</span> <span class="ruby-identifier">new_meth</span>
 885: 
 886:           <span class="ruby-identifier">set_visibility</span>(<span class="ruby-identifier">container</span>, <span class="ruby-identifier">generic_name</span>, <span class="ruby-identifier">visibility_default</span>, <span class="ruby-ivar">@@public_methods</span>)
 887: 
 888:           <span class="ruby-identifier">check_public_methods</span>(<span class="ruby-identifier">new_meth</span>, <span class="ruby-identifier">container</span>.<span class="ruby-identifier">name</span>)
 889: 
 890:         }
 891:       <span class="ruby-keyword kw">end</span>
 892: 
 893:       <span class="ruby-comment cmt"># external aliases</span>
 894:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">interface_scope</span>
 895:         <span class="ruby-comment cmt"># subroutine</span>
 896:         <span class="ruby-identifier">proc</span> = <span class="ruby-keyword kw">nil</span>
 897:         <span class="ruby-identifier">params</span> = <span class="ruby-keyword kw">nil</span>
 898:         <span class="ruby-identifier">procedures_trailing</span> = <span class="ruby-keyword kw">nil</span>
 899:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\s*?
 900:                          (recursive|pure|elemental)?\s*?
 901:                          subroutine\s+(\w+)\s*?(\(.*?\))?\s*?(!.*?)?$
 902:                    /i</span><span class="ruby-identifier">x</span>
 903:           <span class="ruby-identifier">proc</span> = <span class="ruby-identifier">$2</span>.<span class="ruby-identifier">chomp</span>.<span class="ruby-identifier">strip</span>
 904:           <span class="ruby-identifier">generic_name</span> = <span class="ruby-identifier">proc</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">generic_name</span>
 905:           <span class="ruby-identifier">params</span> = <span class="ruby-identifier">$3</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>
 906:           <span class="ruby-identifier">procedures_trailing</span> = <span class="ruby-identifier">$4</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;!&quot;</span>
 907: 
 908:         <span class="ruby-comment cmt"># function</span>
 909:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\s*?
 910:                        (recursive|pure|elemental)?\s*?
 911:                        (
 912:                            character\s*?(\([\w\s\=\(\)\*]+?\))?\s+
 913:                          | type\s*?\([\w\s]+?\)\s+
 914:                          | integer\s*?(\([\w\s\=\(\)\*]+?\))?\s+
 915:                          | real\s*?(\([\w\s\=\(\)\*]+?\))?\s+
 916:                          | double\s+precision\s+
 917:                          | logical\s*?(\([\w\s\=\(\)\*]+?\))?\s+
 918:                          | complex\s*?(\([\w\s\=\(\)\*]+?\))?\s+
 919:                        )?
 920:                        function\s+(\w+)\s*?
 921:                        (\(.*?\))?(\s+result\((.*?)\))?\s*?(!.*?)?$
 922:                       /i</span><span class="ruby-identifier">x</span>
 923:           <span class="ruby-identifier">proc</span> = <span class="ruby-identifier">$8</span>.<span class="ruby-identifier">chomp</span>.<span class="ruby-identifier">strip</span>
 924:           <span class="ruby-identifier">generic_name</span> = <span class="ruby-identifier">proc</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">generic_name</span>
 925:           <span class="ruby-identifier">params</span> = <span class="ruby-identifier">$9</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>
 926:           <span class="ruby-identifier">procedures_trailing</span> = <span class="ruby-identifier">$12</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;!&quot;</span>
 927:         <span class="ruby-keyword kw">else</span>
 928:           <span class="ruby-keyword kw">next</span>
 929:         <span class="ruby-keyword kw">end</span>
 930:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">procedures_trailing</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/!:nodoc:/</span>
 931:         <span class="ruby-identifier">indicated_method</span> = <span class="ruby-keyword kw">nil</span>
 932:         <span class="ruby-identifier">indicated_file</span>   = <span class="ruby-keyword kw">nil</span>
 933:         <span class="ruby-constant">TopLevel</span>.<span class="ruby-identifier">all_files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">toplevel</span><span class="ruby-operator">|</span>
 934:           <span class="ruby-identifier">indicated_method</span> = <span class="ruby-identifier">toplevel</span>.<span class="ruby-identifier">find_local_symbol</span>(<span class="ruby-identifier">proc</span>, <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">ignore_case</span>)
 935:           <span class="ruby-identifier">indicated_file</span> = <span class="ruby-identifier">name</span>
 936:           <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">indicated_method</span>
 937:         <span class="ruby-keyword kw">end</span>
 938: 
 939:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">indicated_method</span>
 940:           <span class="ruby-identifier">external_method</span> = 
 941:             <span class="ruby-identifier">initialize_external_method</span>(<span class="ruby-identifier">generic_name</span>, <span class="ruby-identifier">proc</span>, 
 942:                                        <span class="ruby-identifier">indicated_method</span>.<span class="ruby-identifier">params</span>, 
 943:                                        <span class="ruby-identifier">indicated_file</span>, 
 944:                                        <span class="ruby-identifier">indicated_method</span>.<span class="ruby-identifier">comment</span>)
 945: 
 946:           <span class="ruby-ivar">@stats</span>.<span class="ruby-identifier">add_method</span> <span class="ruby-identifier">external_method</span>
 947: 
 948:           <span class="ruby-identifier">container</span>.<span class="ruby-identifier">add_method</span> <span class="ruby-identifier">external_method</span>
 949:           <span class="ruby-identifier">set_visibility</span>(<span class="ruby-identifier">container</span>, <span class="ruby-identifier">generic_name</span>, <span class="ruby-identifier">visibility_default</span>, <span class="ruby-ivar">@@public_methods</span>)
 950:           <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">container</span>.<span class="ruby-identifier">include_requires?</span>(<span class="ruby-identifier">indicated_file</span>, <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">ignore_case</span>)
 951:             <span class="ruby-identifier">container</span>.<span class="ruby-identifier">add_require</span>(<span class="ruby-constant">Require</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">indicated_file</span>, <span class="ruby-value str">&quot;&quot;</span>))
 952:           <span class="ruby-keyword kw">end</span>
 953:           <span class="ruby-identifier">check_public_methods</span>(<span class="ruby-identifier">external_method</span>, <span class="ruby-identifier">container</span>.<span class="ruby-identifier">name</span>)
 954: 
 955:         <span class="ruby-keyword kw">else</span>
 956:           <span class="ruby-ivar">@@external_aliases</span> <span class="ruby-operator">&lt;&lt;</span> {
 957:             <span class="ruby-value str">&quot;new_name&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">generic_name</span>,
 958:             <span class="ruby-value str">&quot;old_name&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">proc</span>,
 959:             <span class="ruby-value str">&quot;file_or_module&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">container</span>,
 960:             <span class="ruby-value str">&quot;visibility&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">find_visibility</span>(<span class="ruby-identifier">container</span>, <span class="ruby-identifier">generic_name</span>, <span class="ruby-ivar">@@public_methods</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">visibility_default</span>
 961:           }
 962:         <span class="ruby-keyword kw">end</span>
 963:       <span class="ruby-keyword kw">end</span>
 964: 
 965:     } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">interface_code</span> <span class="ruby-comment cmt"># End of interface_code.split(&quot;\n&quot;).each ...</span>
 966: 
 967:     <span class="ruby-comment cmt">#</span>
 968:     <span class="ruby-comment cmt"># Already imported methods are removed from @@public_methods.</span>
 969:     <span class="ruby-comment cmt"># Remainders are assumed to be imported from other modules.</span>
 970:     <span class="ruby-comment cmt">#</span>
 971:     <span class="ruby-ivar">@@public_methods</span>.<span class="ruby-identifier">delete_if</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">method</span><span class="ruby-operator">|</span> <span class="ruby-identifier">method</span>[<span class="ruby-value str">&quot;entity_is_discovered&quot;</span>]}
 972: 
 973:     <span class="ruby-ivar">@@public_methods</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">pub_meth</span><span class="ruby-operator">|</span>
 974:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">pub_meth</span>[<span class="ruby-value str">&quot;file_or_module&quot;</span>].<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">container</span>.<span class="ruby-identifier">name</span>
 975:       <span class="ruby-identifier">pub_meth</span>[<span class="ruby-value str">&quot;used_modules&quot;</span>].<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">used_mod</span><span class="ruby-operator">|</span>
 976:         <span class="ruby-constant">TopLevel</span>.<span class="ruby-identifier">all_classes_and_modules</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">modules</span><span class="ruby-operator">|</span>
 977:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">modules</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">used_mod</span> <span class="ruby-operator">||</span>
 978:               <span class="ruby-identifier">modules</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">upcase</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">used_mod</span>.<span class="ruby-identifier">upcase</span> <span class="ruby-operator">&amp;&amp;</span>
 979:               <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">ignore_case</span>
 980:             <span class="ruby-identifier">modules</span>.<span class="ruby-identifier">method_list</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">meth</span><span class="ruby-operator">|</span>
 981:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pub_meth</span>[<span class="ruby-value str">&quot;name&quot;</span>] <span class="ruby-operator">||</span>
 982:                   <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">upcase</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pub_meth</span>[<span class="ruby-value str">&quot;name&quot;</span>].<span class="ruby-identifier">upcase</span> <span class="ruby-operator">&amp;&amp;</span>
 983:                   <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">ignore_case</span>
 984:                 <span class="ruby-identifier">new_meth</span> = <span class="ruby-identifier">initialize_public_method</span>(<span class="ruby-identifier">meth</span>,
 985:                                                     <span class="ruby-identifier">modules</span>.<span class="ruby-identifier">name</span>)
 986:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pub_meth</span>[<span class="ruby-value str">&quot;local_name&quot;</span>]
 987:                   <span class="ruby-identifier">new_meth</span>.<span class="ruby-identifier">name</span> = <span class="ruby-identifier">pub_meth</span>[<span class="ruby-value str">&quot;local_name&quot;</span>]
 988:                 <span class="ruby-keyword kw">end</span>
 989: 
 990:                 <span class="ruby-ivar">@stats</span>.<span class="ruby-identifier">add_method</span> <span class="ruby-identifier">new_meth</span>
 991: 
 992:                 <span class="ruby-identifier">container</span>.<span class="ruby-identifier">add_method</span> <span class="ruby-identifier">new_meth</span>
 993:               <span class="ruby-keyword kw">end</span>
 994:             }
 995:           <span class="ruby-keyword kw">end</span>
 996:         }
 997:       }
 998:     }
 999: 
1000:     <span class="ruby-identifier">container</span>
1001:   <span class="ruby-keyword kw">end</span></pre>
</body>
</html>
