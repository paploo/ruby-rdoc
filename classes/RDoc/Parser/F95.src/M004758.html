<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>parse_visibility (RDoc::Parser::F95)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="../../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre>      <span class="ruby-comment cmt"># File lib/rdoc/parser/f95.rb, line 1223</span>
1223:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_visibility</span>(<span class="ruby-identifier">code</span>, <span class="ruby-identifier">default</span>, <span class="ruby-identifier">container</span>)
1224:     <span class="ruby-identifier">result</span> = []
1225:     <span class="ruby-identifier">visibility_default</span> = <span class="ruby-identifier">default</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">:public</span>
1226: 
1227:     <span class="ruby-identifier">used_modules</span> = []
1228:     <span class="ruby-identifier">container</span>.<span class="ruby-identifier">includes</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">used_modules</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">name</span>} <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">container</span>
1229: 
1230:     <span class="ruby-identifier">remaining_code</span> = <span class="ruby-identifier">code</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/^\s*?type[\s\,]+.*?\s+end\s+type.*?$/i</span><span class="ruby-identifier">m</span>, <span class="ruby-value str">&quot;&quot;</span>)
1231:     <span class="ruby-identifier">remaining_code</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;\n&quot;</span>).<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
1232:       <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">/^\s*?private\s*?$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">line</span>
1233:         <span class="ruby-identifier">visibility_default</span> = <span class="ruby-identifier">:private</span>
1234:         <span class="ruby-keyword kw">break</span>
1235:       <span class="ruby-keyword kw">end</span>
1236:     } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">remaining_code</span>
1237: 
1238:     <span class="ruby-identifier">remaining_code</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;\n&quot;</span>).<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
1239:       <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">/^\s*?private\s*?(::)?\s+(.*)\s*?(!.*?)?/i</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">line</span>
1240:         <span class="ruby-identifier">methods</span> = <span class="ruby-identifier">$2</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/!.*$/</span>, <span class="ruby-value str">''</span>)
1241:         <span class="ruby-identifier">methods</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;,&quot;</span>).<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">meth</span><span class="ruby-operator">|</span>
1242:           <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp re">/!.*$/</span>, <span class="ruby-value str">''</span>)
1243:           <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/:/</span>, <span class="ruby-value str">''</span>)
1244:           <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> {
1245:             <span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">chomp</span>.<span class="ruby-identifier">strip</span>,
1246:             <span class="ruby-value str">&quot;visibility&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:private</span>,
1247:             <span class="ruby-value str">&quot;used_modules&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">used_modules</span>.<span class="ruby-identifier">clone</span>,
1248:             <span class="ruby-value str">&quot;file_or_module&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">container</span>,
1249:             <span class="ruby-value str">&quot;entity_is_discovered&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>,
1250:             <span class="ruby-value str">&quot;local_name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>
1251:           }
1252:         }
1253:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-regexp re">/^\s*?public\s*?(::)?\s+(.*)\s*?(!.*?)?/i</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">line</span>
1254:         <span class="ruby-identifier">methods</span> = <span class="ruby-identifier">$2</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/!.*$/</span>, <span class="ruby-value str">''</span>)
1255:         <span class="ruby-identifier">methods</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;,&quot;</span>).<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">meth</span><span class="ruby-operator">|</span>
1256:           <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp re">/!.*$/</span>, <span class="ruby-value str">''</span>)
1257:           <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/:/</span>, <span class="ruby-value str">''</span>)
1258:           <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> {
1259:             <span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">chomp</span>.<span class="ruby-identifier">strip</span>,
1260:             <span class="ruby-value str">&quot;visibility&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:public</span>,
1261:             <span class="ruby-value str">&quot;used_modules&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">used_modules</span>.<span class="ruby-identifier">clone</span>,
1262:             <span class="ruby-value str">&quot;file_or_module&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">container</span>,
1263:             <span class="ruby-value str">&quot;entity_is_discovered&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>,
1264:             <span class="ruby-value str">&quot;local_name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>
1265:           }
1266:         }
1267:       <span class="ruby-keyword kw">end</span>
1268:     } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">remaining_code</span>
1269: 
1270:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">container</span>
1271:       <span class="ruby-identifier">result</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">vis_info</span><span class="ruby-operator">|</span>
1272:         <span class="ruby-identifier">vis_info</span>[<span class="ruby-value str">&quot;parent&quot;</span>] = <span class="ruby-identifier">container</span>.<span class="ruby-identifier">name</span>
1273:       }
1274:     <span class="ruby-keyword kw">end</span>
1275: 
1276:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">visibility_default</span>, <span class="ruby-identifier">result</span>
1277:   <span class="ruby-keyword kw">end</span></pre>
</body>
</html>
