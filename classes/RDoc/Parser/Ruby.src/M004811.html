<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>parse_statements (RDoc::Parser::Ruby)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="../../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre>      <span class="ruby-comment cmt"># File lib/rdoc/parser/ruby.rb, line 2324</span>
2324:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_statements</span>(<span class="ruby-identifier">container</span>, <span class="ruby-identifier">single</span> = <span class="ruby-constant">NORMAL</span>, <span class="ruby-identifier">current_method</span> = <span class="ruby-keyword kw">nil</span>,
2325:                        <span class="ruby-identifier">comment</span> = <span class="ruby-value str">''</span>)
2326:     <span class="ruby-identifier">nest</span> = <span class="ruby-value">1</span>
2327:     <span class="ruby-identifier">save_visibility</span> = <span class="ruby-identifier">container</span>.<span class="ruby-identifier">visibility</span>
2328: 
2329:     <span class="ruby-identifier">non_comment_seen</span> = <span class="ruby-keyword kw">true</span>
2330: 
2331:     <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">tk</span> = <span class="ruby-identifier">get_tk</span> <span class="ruby-keyword kw">do</span>
2332:       <span class="ruby-identifier">keep_comment</span> = <span class="ruby-keyword kw">false</span>
2333: 
2334:       <span class="ruby-identifier">non_comment_seen</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">TkCOMMENT</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">tk</span>
2335: 
2336:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">tk</span>
2337:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">TkNL</span> <span class="ruby-keyword kw">then</span>
2338:         <span class="ruby-identifier">skip_tkspace</span> <span class="ruby-keyword kw">true</span> <span class="ruby-comment cmt"># Skip blanks and newlines</span>
2339:         <span class="ruby-identifier">tk</span> = <span class="ruby-identifier">get_tk</span>
2340: 
2341:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TkCOMMENT</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">tk</span> <span class="ruby-keyword kw">then</span>
2342:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">non_comment_seen</span> <span class="ruby-keyword kw">then</span>
2343:             <span class="ruby-comment cmt"># Look for RDoc in a comment about to be thrown away</span>
2344:             <span class="ruby-identifier">parse_comment</span> <span class="ruby-identifier">container</span>, <span class="ruby-identifier">tk</span>, <span class="ruby-identifier">comment</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">empty?</span>
2345: 
2346:             <span class="ruby-identifier">comment</span> = <span class="ruby-value str">''</span>
2347:             <span class="ruby-identifier">non_comment_seen</span> = <span class="ruby-keyword kw">false</span>
2348:           <span class="ruby-keyword kw">end</span>
2349: 
2350:           <span class="ruby-keyword kw">while</span> <span class="ruby-constant">TkCOMMENT</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">tk</span> <span class="ruby-keyword kw">do</span>
2351:             <span class="ruby-identifier">comment</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">tk</span>.<span class="ruby-identifier">text</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
2352:             <span class="ruby-identifier">tk</span> = <span class="ruby-identifier">get_tk</span>          <span class="ruby-comment cmt"># this is the newline</span>
2353:             <span class="ruby-identifier">skip_tkspace</span>(<span class="ruby-keyword kw">false</span>)  <span class="ruby-comment cmt"># leading spaces</span>
2354:             <span class="ruby-identifier">tk</span> = <span class="ruby-identifier">get_tk</span>
2355:           <span class="ruby-keyword kw">end</span>
2356: 
2357:           <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">then</span>
2358:             <span class="ruby-identifier">look_for_directives_in</span> <span class="ruby-identifier">container</span>, <span class="ruby-identifier">comment</span>
2359: 
2360:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">container</span>.<span class="ruby-identifier">done_documenting</span> <span class="ruby-keyword kw">then</span>
2361:               <span class="ruby-identifier">container</span>.<span class="ruby-identifier">ongoing_visibility</span> = <span class="ruby-identifier">save_visibility</span>
2362:             <span class="ruby-keyword kw">end</span>
2363:           <span class="ruby-keyword kw">end</span>
2364: 
2365:           <span class="ruby-identifier">keep_comment</span> = <span class="ruby-keyword kw">true</span>
2366:         <span class="ruby-keyword kw">else</span>
2367:           <span class="ruby-identifier">non_comment_seen</span> = <span class="ruby-keyword kw">true</span>
2368:         <span class="ruby-keyword kw">end</span>
2369: 
2370:         <span class="ruby-identifier">unget_tk</span> <span class="ruby-identifier">tk</span>
2371:         <span class="ruby-identifier">keep_comment</span> = <span class="ruby-keyword kw">true</span>
2372: 
2373:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">TkCLASS</span> <span class="ruby-keyword kw">then</span>
2374:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">container</span>.<span class="ruby-identifier">document_children</span> <span class="ruby-keyword kw">then</span>
2375:           <span class="ruby-identifier">parse_class</span> <span class="ruby-identifier">container</span>, <span class="ruby-identifier">single</span>, <span class="ruby-identifier">tk</span>, <span class="ruby-identifier">comment</span>
2376:         <span class="ruby-keyword kw">else</span>
2377:           <span class="ruby-identifier">nest</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
2378:         <span class="ruby-keyword kw">end</span>
2379: 
2380:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">TkMODULE</span> <span class="ruby-keyword kw">then</span>
2381:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">container</span>.<span class="ruby-identifier">document_children</span> <span class="ruby-keyword kw">then</span>
2382:           <span class="ruby-identifier">parse_module</span> <span class="ruby-identifier">container</span>, <span class="ruby-identifier">single</span>, <span class="ruby-identifier">tk</span>, <span class="ruby-identifier">comment</span>
2383:         <span class="ruby-keyword kw">else</span>
2384:           <span class="ruby-identifier">nest</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
2385:         <span class="ruby-keyword kw">end</span>
2386: 
2387:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">TkDEF</span> <span class="ruby-keyword kw">then</span>
2388:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">container</span>.<span class="ruby-identifier">document_self</span> <span class="ruby-keyword kw">then</span>
2389:           <span class="ruby-identifier">parse_method</span> <span class="ruby-identifier">container</span>, <span class="ruby-identifier">single</span>, <span class="ruby-identifier">tk</span>, <span class="ruby-identifier">comment</span>
2390:         <span class="ruby-keyword kw">else</span>
2391:           <span class="ruby-identifier">nest</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
2392:         <span class="ruby-keyword kw">end</span>
2393: 
2394:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">TkCONSTANT</span> <span class="ruby-keyword kw">then</span>
2395:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">container</span>.<span class="ruby-identifier">document_self</span> <span class="ruby-keyword kw">then</span>
2396:           <span class="ruby-identifier">parse_constant</span> <span class="ruby-identifier">container</span>, <span class="ruby-identifier">single</span>, <span class="ruby-identifier">tk</span>, <span class="ruby-identifier">comment</span>
2397:         <span class="ruby-keyword kw">end</span>
2398: 
2399:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">TkALIAS</span> <span class="ruby-keyword kw">then</span>
2400:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">container</span>.<span class="ruby-identifier">document_self</span> <span class="ruby-keyword kw">then</span>
2401:           <span class="ruby-identifier">parse_alias</span> <span class="ruby-identifier">container</span>, <span class="ruby-identifier">single</span>, <span class="ruby-identifier">tk</span>, <span class="ruby-identifier">comment</span>
2402:         <span class="ruby-keyword kw">end</span>
2403: 
2404:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">TkYIELD</span> <span class="ruby-keyword kw">then</span>
2405:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_method</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">then</span>
2406:           <span class="ruby-identifier">warn</span> <span class="ruby-value str">&quot;Warning: yield outside of method&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">container</span>.<span class="ruby-identifier">document_self</span>
2407:         <span class="ruby-keyword kw">else</span>
2408:           <span class="ruby-identifier">parse_yield</span> <span class="ruby-identifier">container</span>, <span class="ruby-identifier">single</span>, <span class="ruby-identifier">tk</span>, <span class="ruby-identifier">current_method</span>
2409:         <span class="ruby-keyword kw">end</span>
2410: 
2411:       <span class="ruby-comment cmt"># Until and While can have a 'do', which shouldn't increase the nesting.</span>
2412:       <span class="ruby-comment cmt"># We can't solve the general case, but we can handle most occurrences by</span>
2413:       <span class="ruby-comment cmt"># ignoring a do at the end of a line.</span>
2414: 
2415:       <span class="ruby-keyword kw">when</span>  <span class="ruby-constant">TkUNTIL</span>, <span class="ruby-constant">TkWHILE</span> <span class="ruby-keyword kw">then</span>
2416:         <span class="ruby-identifier">nest</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
2417:         <span class="ruby-identifier">skip_optional_do_after_expression</span>
2418: 
2419:       <span class="ruby-comment cmt"># 'for' is trickier</span>
2420:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">TkFOR</span> <span class="ruby-keyword kw">then</span>
2421:         <span class="ruby-identifier">nest</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
2422:         <span class="ruby-identifier">skip_for_variable</span>
2423:         <span class="ruby-identifier">skip_optional_do_after_expression</span>
2424: 
2425:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">TkCASE</span>, <span class="ruby-constant">TkDO</span>, <span class="ruby-constant">TkIF</span>, <span class="ruby-constant">TkUNLESS</span>, <span class="ruby-constant">TkBEGIN</span> <span class="ruby-keyword kw">then</span>
2426:         <span class="ruby-identifier">nest</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
2427: 
2428:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">TkIDENTIFIER</span> <span class="ruby-keyword kw">then</span>
2429:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">nest</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">current_method</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">then</span>
2430:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">tk</span>.<span class="ruby-identifier">name</span>
2431:           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'private'</span>, <span class="ruby-value str">'protected'</span>, <span class="ruby-value str">'public'</span>, <span class="ruby-value str">'private_class_method'</span>,
2432:                <span class="ruby-value str">'public_class_method'</span>, <span class="ruby-value str">'module_function'</span> <span class="ruby-keyword kw">then</span>
2433:             <span class="ruby-identifier">parse_visibility</span> <span class="ruby-identifier">container</span>, <span class="ruby-identifier">single</span>, <span class="ruby-identifier">tk</span>
2434:             <span class="ruby-identifier">keep_comment</span> = <span class="ruby-keyword kw">true</span>
2435:           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'attr'</span> <span class="ruby-keyword kw">then</span>
2436:             <span class="ruby-identifier">parse_attr</span> <span class="ruby-identifier">container</span>, <span class="ruby-identifier">single</span>, <span class="ruby-identifier">tk</span>, <span class="ruby-identifier">comment</span>
2437:           <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/^attr_(reader|writer|accessor)$/</span>, <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">extra_accessors</span> <span class="ruby-keyword kw">then</span>
2438:             <span class="ruby-identifier">parse_attr_accessor</span> <span class="ruby-identifier">container</span>, <span class="ruby-identifier">single</span>, <span class="ruby-identifier">tk</span>, <span class="ruby-identifier">comment</span>
2439:           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'alias_method'</span> <span class="ruby-keyword kw">then</span>
2440:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">container</span>.<span class="ruby-identifier">document_self</span> <span class="ruby-keyword kw">then</span>
2441:               <span class="ruby-identifier">parse_alias</span> <span class="ruby-identifier">container</span>, <span class="ruby-identifier">single</span>, <span class="ruby-identifier">tk</span>, <span class="ruby-identifier">comment</span>
2442:             <span class="ruby-keyword kw">end</span>
2443:           <span class="ruby-keyword kw">else</span>
2444:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">container</span>.<span class="ruby-identifier">document_self</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">comment</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\A#\#$/</span> <span class="ruby-keyword kw">then</span>
2445:               <span class="ruby-identifier">parse_meta_method</span> <span class="ruby-identifier">container</span>, <span class="ruby-identifier">single</span>, <span class="ruby-identifier">tk</span>, <span class="ruby-identifier">comment</span>
2446:             <span class="ruby-keyword kw">end</span>
2447:           <span class="ruby-keyword kw">end</span>
2448:         <span class="ruby-keyword kw">end</span>
2449: 
2450:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">tk</span>.<span class="ruby-identifier">name</span>
2451:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;require&quot;</span> <span class="ruby-keyword kw">then</span>
2452:           <span class="ruby-identifier">parse_require</span> <span class="ruby-identifier">container</span>, <span class="ruby-identifier">comment</span>
2453:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;include&quot;</span> <span class="ruby-keyword kw">then</span>
2454:           <span class="ruby-identifier">parse_include</span> <span class="ruby-identifier">container</span>, <span class="ruby-identifier">comment</span>
2455:         <span class="ruby-keyword kw">end</span>
2456: 
2457:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">TkEND</span> <span class="ruby-keyword kw">then</span>
2458:         <span class="ruby-identifier">nest</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
2459:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">nest</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">then</span>
2460:           <span class="ruby-identifier">read_documentation_modifiers</span> <span class="ruby-identifier">container</span>, <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">CLASS_MODIFIERS</span>
2461:           <span class="ruby-identifier">container</span>.<span class="ruby-identifier">ongoing_visibility</span> = <span class="ruby-identifier">save_visibility</span>
2462:           <span class="ruby-keyword kw">return</span>
2463:         <span class="ruby-keyword kw">end</span>
2464: 
2465:       <span class="ruby-keyword kw">end</span>
2466: 
2467:       <span class="ruby-identifier">comment</span> = <span class="ruby-value str">''</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">keep_comment</span>
2468: 
2469:       <span class="ruby-keyword kw">begin</span>
2470:         <span class="ruby-identifier">get_tkread</span>
2471:         <span class="ruby-identifier">skip_tkspace</span>(<span class="ruby-keyword kw">false</span>)
2472:       <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">peek_tk</span> <span class="ruby-operator">==</span> <span class="ruby-constant">TkNL</span>
2473:     <span class="ruby-keyword kw">end</span>
2474:   <span class="ruby-keyword kw">end</span></pre>
</body>
</html>
