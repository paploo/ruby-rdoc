<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>parse_meta_method (RDoc::Parser::Ruby)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="../../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre>      <span class="ruby-comment cmt"># File lib/rdoc/parser/ruby.rb, line 2025</span>
2025:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_meta_method</span>(<span class="ruby-identifier">container</span>, <span class="ruby-identifier">single</span>, <span class="ruby-identifier">tk</span>, <span class="ruby-identifier">comment</span>)
2026:     <span class="ruby-identifier">line_no</span> = <span class="ruby-identifier">tk</span>.<span class="ruby-identifier">line_no</span>
2027:     <span class="ruby-identifier">column</span>  = <span class="ruby-identifier">tk</span>.<span class="ruby-identifier">char_no</span>
2028: 
2029:     <span class="ruby-identifier">start_collecting_tokens</span>
2030:     <span class="ruby-identifier">add_token</span> <span class="ruby-identifier">tk</span>
2031:     <span class="ruby-identifier">add_token_listener</span> <span class="ruby-keyword kw">self</span>
2032: 
2033:     <span class="ruby-identifier">skip_tkspace</span> <span class="ruby-keyword kw">false</span>
2034: 
2035:     <span class="ruby-identifier">singleton</span> = <span class="ruby-operator">!</span><span class="ruby-operator">!</span><span class="ruby-identifier">comment</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp re">/(^# +:?)(singleton-)(method:)/</span>, <span class="ruby-value str">'\1\3'</span>)
2036: 
2037:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp re">/^# +:?method: *(\S*).*?\n/i</span>, <span class="ruby-value str">''</span>) <span class="ruby-keyword kw">then</span>
2038:       <span class="ruby-identifier">name</span> = <span class="ruby-identifier">$1</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">empty?</span>
2039:     <span class="ruby-keyword kw">end</span>
2040: 
2041:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">then</span>
2042:       <span class="ruby-identifier">name_t</span> = <span class="ruby-identifier">get_tk</span>
2043:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">name_t</span>
2044:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">TkSYMBOL</span> <span class="ruby-keyword kw">then</span>
2045:         <span class="ruby-identifier">name</span> = <span class="ruby-identifier">name_t</span>.<span class="ruby-identifier">text</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
2046:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">TkSTRING</span> <span class="ruby-keyword kw">then</span>
2047:         <span class="ruby-identifier">name</span> = <span class="ruby-identifier">name_t</span>.<span class="ruby-identifier">text</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>]
2048:       <span class="ruby-keyword kw">else</span>
2049:         <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;#{container.top_level.file_relative_name}:#{name_t.line_no} unknown name token #{name_t.inspect} for meta-method&quot;</span>
2050:         <span class="ruby-identifier">name</span> = <span class="ruby-value str">'unknown'</span>
2051:       <span class="ruby-keyword kw">end</span>
2052:     <span class="ruby-keyword kw">end</span>
2053: 
2054:     <span class="ruby-identifier">meth</span> = <span class="ruby-constant">RDoc</span><span class="ruby-operator">::</span><span class="ruby-constant">MetaMethod</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">get_tkread</span>, <span class="ruby-identifier">name</span>
2055:     <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">singleton</span> = <span class="ruby-identifier">singleton</span>
2056: 
2057:     <span class="ruby-ivar">@stats</span>.<span class="ruby-identifier">add_method</span> <span class="ruby-identifier">meth</span>
2058: 
2059:     <span class="ruby-identifier">remove_token_listener</span> <span class="ruby-keyword kw">self</span>
2060: 
2061:     <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">start_collecting_tokens</span>
2062:     <span class="ruby-identifier">indent</span> = <span class="ruby-constant">TkSPACE</span>.<span class="ruby-identifier">new</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>
2063:     <span class="ruby-identifier">indent</span>.<span class="ruby-identifier">set_text</span> <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">column</span>
2064: 
2065:     <span class="ruby-identifier">position_comment</span> = <span class="ruby-constant">TkCOMMENT</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">line_no</span>, <span class="ruby-value">1</span>, <span class="ruby-node">&quot;# File #{@top_level.file_absolute_name}, line #{line_no}&quot;</span>)
2066:     <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">add_tokens</span> [<span class="ruby-identifier">position_comment</span>, <span class="ruby-constant">NEWLINE_TOKEN</span>, <span class="ruby-identifier">indent</span>]
2067:     <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">add_tokens</span> <span class="ruby-ivar">@token_stream</span>
2068: 
2069:     <span class="ruby-identifier">add_token_listener</span> <span class="ruby-identifier">meth</span>
2070: 
2071:     <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">params</span> = <span class="ruby-value str">''</span>
2072: 
2073:     <span class="ruby-identifier">extract_call_seq</span> <span class="ruby-identifier">comment</span>, <span class="ruby-identifier">meth</span>
2074: 
2075:     <span class="ruby-identifier">container</span>.<span class="ruby-identifier">add_method</span> <span class="ruby-identifier">meth</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">document_self</span>
2076: 
2077:     <span class="ruby-identifier">last_tk</span> = <span class="ruby-identifier">tk</span>
2078: 
2079:     <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">tk</span> = <span class="ruby-identifier">get_tk</span> <span class="ruby-keyword kw">do</span>
2080:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">tk</span>
2081:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">TkSEMICOLON</span> <span class="ruby-keyword kw">then</span>
2082:         <span class="ruby-keyword kw">break</span>
2083:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">TkNL</span> <span class="ruby-keyword kw">then</span>
2084:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">last_tk</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TkCOMMA</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">last_tk</span>
2085:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">TkSPACE</span> <span class="ruby-keyword kw">then</span>
2086:         <span class="ruby-comment cmt"># expression continues</span>
2087:       <span class="ruby-keyword kw">else</span>
2088:         <span class="ruby-identifier">last_tk</span> = <span class="ruby-identifier">tk</span>
2089:       <span class="ruby-keyword kw">end</span>
2090:     <span class="ruby-keyword kw">end</span>
2091: 
2092:     <span class="ruby-identifier">remove_token_listener</span> <span class="ruby-identifier">meth</span>
2093: 
2094:     <span class="ruby-identifier">meth</span>.<span class="ruby-identifier">comment</span> = <span class="ruby-identifier">comment</span>
2095:   <span class="ruby-keyword kw">end</span></pre>
</body>
</html>
