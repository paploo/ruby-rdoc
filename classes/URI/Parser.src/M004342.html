<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>initialize_pattern (URI::Parser)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre>     <span class="ruby-comment cmt"># File lib/uri/common.rb, line 240</span>
240:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize_pattern</span>(<span class="ruby-identifier">opts</span> = {})
241:       <span class="ruby-identifier">ret</span> = {}
242:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:ESCAPED</span>] = <span class="ruby-identifier">escaped</span> = (<span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:ESCAPED</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">PATTERN</span><span class="ruby-operator">::</span><span class="ruby-constant">ESCAPED</span>)
243:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:UNRESERVED</span>] = <span class="ruby-identifier">unreserved</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:UNRESERVED</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">PATTERN</span><span class="ruby-operator">::</span><span class="ruby-constant">UNRESERVED</span>
244:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:RESERVED</span>] = <span class="ruby-identifier">reserved</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:RESERVED</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">PATTERN</span><span class="ruby-operator">::</span><span class="ruby-constant">RESERVED</span>
245:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:DOMLABEL</span>] = <span class="ruby-identifier">domlabel</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:DOMLABEL</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">PATTERN</span><span class="ruby-operator">::</span><span class="ruby-constant">DOMLABEL</span>
246:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:TOPLABEL</span>] = <span class="ruby-identifier">toplabel</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:TOPLABEL</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">PATTERN</span><span class="ruby-operator">::</span><span class="ruby-constant">TOPLABEL</span>
247:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:HOSTNAME</span>] = <span class="ruby-identifier">hostname</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:HOSTNAME</span>)
248: 
249:       <span class="ruby-comment cmt"># RFC 2396 (URI Generic Syntax)</span>
250:       <span class="ruby-comment cmt"># RFC 2732 (IPv6 Literal Addresses in URL's)</span>
251:       <span class="ruby-comment cmt"># RFC 2373 (IPv6 Addressing Architecture)</span>
252: 
253:       <span class="ruby-comment cmt"># uric          = reserved | unreserved | escaped</span>
254:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:URIC</span>] = <span class="ruby-identifier">uric</span> = <span class="ruby-node">&quot;(?:[#{unreserved}#{reserved}]|#{escaped})&quot;</span>
255:       <span class="ruby-comment cmt"># uric_no_slash = unreserved | escaped | &quot;;&quot; | &quot;?&quot; | &quot;:&quot; | &quot;@&quot; |</span>
256:       <span class="ruby-comment cmt">#                 &quot;&amp;&quot; | &quot;=&quot; | &quot;+&quot; | &quot;$&quot; | &quot;,&quot;</span>
257:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:URIC_NO_SLASH</span>] = <span class="ruby-identifier">uric_no_slash</span> = <span class="ruby-node">&quot;(?:[#{unreserved};?:@&amp;=+$,]|#{escaped})&quot;</span>
258:       <span class="ruby-comment cmt"># query         = *uric</span>
259:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:QUERY</span>] = <span class="ruby-identifier">query</span> = <span class="ruby-node">&quot;#{uric}*&quot;</span>
260:       <span class="ruby-comment cmt"># fragment      = *uric</span>
261:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:FRAGMENT</span>] = <span class="ruby-identifier">fragment</span> = <span class="ruby-node">&quot;#{uric}*&quot;</span>
262: 
263:       <span class="ruby-comment cmt"># hostname      = *( domainlabel &quot;.&quot; ) toplabel [ &quot;.&quot; ]</span>
264:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">hostname</span>
265:         <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:HOSTNAME</span>] = <span class="ruby-identifier">hostname</span> = <span class="ruby-node">&quot;(?:#{domlabel}\\.)*#{toplabel}\\.?&quot;</span>
266:       <span class="ruby-keyword kw">end</span>
267: 
268:       <span class="ruby-comment cmt"># RFC 2373, APPENDIX B:</span>
269:       <span class="ruby-comment cmt"># IPv6address = hexpart [ &quot;:&quot; IPv4address ]</span>
270:       <span class="ruby-comment cmt"># IPv4address   = 1*3DIGIT &quot;.&quot; 1*3DIGIT &quot;.&quot; 1*3DIGIT &quot;.&quot; 1*3DIGIT</span>
271:       <span class="ruby-comment cmt"># hexpart = hexseq | hexseq &quot;::&quot; [ hexseq ] | &quot;::&quot; [ hexseq ]</span>
272:       <span class="ruby-comment cmt"># hexseq  = hex4 *( &quot;:&quot; hex4)</span>
273:       <span class="ruby-comment cmt"># hex4    = 1*4HEXDIG</span>
274:       <span class="ruby-comment cmt">#</span>
275:       <span class="ruby-comment cmt"># XXX: This definition has a flaw. &quot;::&quot; + IPv4address must be</span>
276:       <span class="ruby-comment cmt"># allowed too.  Here is a replacement.</span>
277:       <span class="ruby-comment cmt">#</span>
278:       <span class="ruby-comment cmt"># IPv4address = 1*3DIGIT &quot;.&quot; 1*3DIGIT &quot;.&quot; 1*3DIGIT &quot;.&quot; 1*3DIGIT</span>
279:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:IPV4ADDR</span>] = <span class="ruby-identifier">ipv4addr</span> = <span class="ruby-value str">&quot;\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}&quot;</span>
280:       <span class="ruby-comment cmt"># hex4     = 1*4HEXDIG</span>
281:       <span class="ruby-identifier">hex4</span> = <span class="ruby-node">&quot;[#{PATTERN::HEX}]{1,4}&quot;</span>
282:       <span class="ruby-comment cmt"># lastpart = hex4 | IPv4address</span>
283:       <span class="ruby-identifier">lastpart</span> = <span class="ruby-node">&quot;(?:#{hex4}|#{ipv4addr})&quot;</span>
284:       <span class="ruby-comment cmt"># hexseq1  = *( hex4 &quot;:&quot; ) hex4</span>
285:       <span class="ruby-identifier">hexseq1</span> = <span class="ruby-node">&quot;(?:#{hex4}:)*#{hex4}&quot;</span>
286:       <span class="ruby-comment cmt"># hexseq2  = *( hex4 &quot;:&quot; ) lastpart</span>
287:       <span class="ruby-identifier">hexseq2</span> = <span class="ruby-node">&quot;(?:#{hex4}:)*#{lastpart}&quot;</span>
288:       <span class="ruby-comment cmt"># IPv6address = hexseq2 | [ hexseq1 ] &quot;::&quot; [ hexseq2 ]</span>
289:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:IPV6ADDR</span>] = <span class="ruby-identifier">ipv6addr</span> = <span class="ruby-node">&quot;(?:#{hexseq2}|(?:#{hexseq1})?::(?:#{hexseq2})?)&quot;</span>
290: 
291:       <span class="ruby-comment cmt"># IPv6prefix  = ( hexseq1 | [ hexseq1 ] &quot;::&quot; [ hexseq1 ] ) &quot;/&quot; 1*2DIGIT</span>
292:       <span class="ruby-comment cmt"># unused</span>
293: 
294:       <span class="ruby-comment cmt"># ipv6reference = &quot;[&quot; IPv6address &quot;]&quot; (RFC 2732)</span>
295:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:IPV6REF</span>] = <span class="ruby-identifier">ipv6ref</span> = <span class="ruby-node">&quot;\\[#{ipv6addr}\\]&quot;</span>
296: 
297:       <span class="ruby-comment cmt"># host          = hostname | IPv4address</span>
298:       <span class="ruby-comment cmt"># host          = hostname | IPv4address | IPv6reference (RFC 2732)</span>
299:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:HOST</span>] = <span class="ruby-identifier">host</span> = <span class="ruby-node">&quot;(?:#{hostname}|#{ipv4addr}|#{ipv6ref})&quot;</span>
300:       <span class="ruby-comment cmt"># port          = *digit</span>
301:       <span class="ruby-identifier">port</span> = <span class="ruby-value str">'\d*'</span>
302:       <span class="ruby-comment cmt"># hostport      = host [ &quot;:&quot; port ]</span>
303:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:HOSTPORT</span>] = <span class="ruby-identifier">hostport</span> = <span class="ruby-node">&quot;#{host}(?::#{port})?&quot;</span>
304: 
305:       <span class="ruby-comment cmt"># userinfo      = *( unreserved | escaped |</span>
306:       <span class="ruby-comment cmt">#                    &quot;;&quot; | &quot;:&quot; | &quot;&amp;&quot; | &quot;=&quot; | &quot;+&quot; | &quot;$&quot; | &quot;,&quot; )</span>
307:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:USERINFO</span>] = <span class="ruby-identifier">userinfo</span> = <span class="ruby-node">&quot;(?:[#{unreserved};:&amp;=+$,]|#{escaped})*&quot;</span>
308: 
309:       <span class="ruby-comment cmt"># pchar         = unreserved | escaped |</span>
310:       <span class="ruby-comment cmt">#                 &quot;:&quot; | &quot;@&quot; | &quot;&amp;&quot; | &quot;=&quot; | &quot;+&quot; | &quot;$&quot; | &quot;,&quot;</span>
311:       <span class="ruby-identifier">pchar</span> = <span class="ruby-node">&quot;(?:[#{unreserved}:@&amp;=+$,]|#{escaped})&quot;</span>
312:       <span class="ruby-comment cmt"># param         = *pchar</span>
313:       <span class="ruby-identifier">param</span> = <span class="ruby-node">&quot;#{pchar}*&quot;</span>
314:       <span class="ruby-comment cmt"># segment       = *pchar *( &quot;;&quot; param )</span>
315:       <span class="ruby-identifier">segment</span> = <span class="ruby-node">&quot;#{pchar}*(?:;#{param})*&quot;</span>
316:       <span class="ruby-comment cmt"># path_segments = segment *( &quot;/&quot; segment )</span>
317:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:PATH_SEGMENTS</span>] = <span class="ruby-identifier">path_segments</span> = <span class="ruby-node">&quot;#{segment}(?:/#{segment})*&quot;</span>
318: 
319:       <span class="ruby-comment cmt"># server        = [ [ userinfo &quot;@&quot; ] hostport ]</span>
320:       <span class="ruby-identifier">server</span> = <span class="ruby-node">&quot;(?:#{userinfo}@)?#{hostport}&quot;</span>
321:       <span class="ruby-comment cmt"># reg_name      = 1*( unreserved | escaped | &quot;$&quot; | &quot;,&quot; |</span>
322:       <span class="ruby-comment cmt">#                     &quot;;&quot; | &quot;:&quot; | &quot;@&quot; | &quot;&amp;&quot; | &quot;=&quot; | &quot;+&quot; )</span>
323:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:REG_NAME</span>] = <span class="ruby-identifier">reg_name</span> = <span class="ruby-node">&quot;(?:[#{unreserved}$,;:@&amp;=+]|#{escaped})+&quot;</span>
324:       <span class="ruby-comment cmt"># authority     = server | reg_name</span>
325:       <span class="ruby-identifier">authority</span> = <span class="ruby-node">&quot;(?:#{server}|#{reg_name})&quot;</span>
326: 
327:       <span class="ruby-comment cmt"># rel_segment   = 1*( unreserved | escaped |</span>
328:       <span class="ruby-comment cmt">#                     &quot;;&quot; | &quot;@&quot; | &quot;&amp;&quot; | &quot;=&quot; | &quot;+&quot; | &quot;$&quot; | &quot;,&quot; )</span>
329:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:REL_SEGMENT</span>] = <span class="ruby-identifier">rel_segment</span> = <span class="ruby-node">&quot;(?:[#{unreserved};@&amp;=+$,]|#{escaped})+&quot;</span>
330: 
331:       <span class="ruby-comment cmt"># scheme        = alpha *( alpha | digit | &quot;+&quot; | &quot;-&quot; | &quot;.&quot; )</span>
332:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:SCHEME</span>] = <span class="ruby-identifier">scheme</span> = <span class="ruby-node">&quot;[#{PATTERN::ALPHA}][-+.#{PATTERN::ALPHA}\\d]*&quot;</span>
333: 
334:       <span class="ruby-comment cmt"># abs_path      = &quot;/&quot;  path_segments</span>
335:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:ABS_PATH</span>] = <span class="ruby-identifier">abs_path</span> = <span class="ruby-node">&quot;/#{path_segments}&quot;</span>
336:       <span class="ruby-comment cmt"># rel_path      = rel_segment [ abs_path ]</span>
337:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:REL_PATH</span>] = <span class="ruby-identifier">rel_path</span> = <span class="ruby-node">&quot;#{rel_segment}(?:#{abs_path})?&quot;</span>
338:       <span class="ruby-comment cmt"># net_path      = &quot;//&quot; authority [ abs_path ]</span>
339:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:NET_PATH</span>] = <span class="ruby-identifier">net_path</span> = <span class="ruby-node">&quot;//#{authority}(?:#{abs_path})?&quot;</span>
340: 
341:       <span class="ruby-comment cmt"># hier_part     = ( net_path | abs_path ) [ &quot;?&quot; query ]</span>
342:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:HIER_PART</span>] = <span class="ruby-identifier">hier_part</span> = <span class="ruby-node">&quot;(?:#{net_path}|#{abs_path})(?:\\?(?:#{query}))?&quot;</span>
343:       <span class="ruby-comment cmt"># opaque_part   = uric_no_slash *uric</span>
344:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:OPAQUE_PART</span>] = <span class="ruby-identifier">opaque_part</span> = <span class="ruby-node">&quot;#{uric_no_slash}#{uric}*&quot;</span>
345: 
346:       <span class="ruby-comment cmt"># absoluteURI   = scheme &quot;:&quot; ( hier_part | opaque_part )</span>
347:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:ABS_URI</span>] = <span class="ruby-identifier">abs_uri</span> = <span class="ruby-node">&quot;#{scheme}:(?:#{hier_part}|#{opaque_part})&quot;</span>
348:       <span class="ruby-comment cmt"># relativeURI   = ( net_path | abs_path | rel_path ) [ &quot;?&quot; query ]</span>
349:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:REL_URI</span>] = <span class="ruby-identifier">rel_uri</span> = <span class="ruby-node">&quot;(?:#{net_path}|#{abs_path}|#{rel_path})(?:\\?#{query})?&quot;</span>
350: 
351:       <span class="ruby-comment cmt"># URI-reference = [ absoluteURI | relativeURI ] [ &quot;#&quot; fragment ]</span>
352:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:URI_REF</span>] = <span class="ruby-identifier">uri_ref</span> = <span class="ruby-node">&quot;(?:#{abs_uri}|#{rel_uri})?(?:##{fragment})?&quot;</span>
353: 
354:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:X_ABS_URI</span>] = <span class="ruby-node">&quot;
355:         (#{scheme}):                           (?# 1: scheme)
356:         (?:
357:            (#{opaque_part})                    (?# 2: opaque)
358:         |
359:            (?:(?:
360:              //(?:
361:                  (?:(?:(#{userinfo})@)?        (?# 3: userinfo)
362:                    (?:(#{host})(?::(\\d*))?))? (?# 4: host, 5: port)
363:                |
364:                  (#{reg_name})                 (?# 6: registry)
365:                )
366:              |
367:              (?!//))                           (?# XXX: '//' is the mark for hostport)
368:              (#{abs_path})?                    (?# 7: path)
369:            )(?:\\?(#{query}))?                 (?# 8: query)
370:         )
371:         (?:\\#(#{fragment}))?                  (?# 9: fragment)
372:       &quot;</span>
373: 
374:       <span class="ruby-identifier">ret</span>[<span class="ruby-identifier">:X_REL_URI</span>] = <span class="ruby-node">&quot;
375:         (?:
376:           (?:
377:             //
378:             (?:
379:               (?:(#{userinfo})@)?       (?# 1: userinfo)
380:                 (#{host})?(?::(\\d*))?  (?# 2: host, 3: port)
381:             |
382:               (#{reg_name})             (?# 4: registry)
383:             )
384:           )
385:         |
386:           (#{rel_segment})              (?# 5: rel_segment)
387:         )?
388:         (#{abs_path})?                  (?# 6: abs_path)
389:         (?:\\?(#{query}))?              (?# 7: query)
390:         (?:\\#(#{fragment}))?           (?# 8: fragment)
391:       &quot;</span>
392: 
393:       <span class="ruby-identifier">ret</span>
394:     <span class="ruby-keyword kw">end</span></pre>
</body>
</html>
