<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>new (OpenSSL::PKey::EC::Point)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="../../../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre>/*
 *  call-seq:
 *     OpenSSL::PKey::EC::Point.new(point)
 *     OpenSSL::PKey::EC::Point.new(group)
 *     OpenSSL::PKey::EC::Point.new(group, bn)
 *
 *  See the OpenSSL documentation for EC_POINT_*
 */
static VALUE ossl_ec_point_initialize(int argc, VALUE *argv, VALUE self)
{
    ossl_ec_point *ec_point;
    EC_POINT *point = NULL;
    VALUE arg1, arg2;
    VALUE group_v = Qnil;
    const EC_GROUP *group = NULL;

    Data_Get_Struct(self, ossl_ec_point, ec_point);
    if (ec_point-&gt;point)
        rb_raise(eEC_POINT, &quot;EC_POINT already initialized&quot;);

    switch (rb_scan_args(argc, argv, &quot;11&quot;, &amp;arg1, &amp;arg2)) {
    case 1:
        if (rb_obj_is_kind_of(arg1, cEC_POINT)) {
            const EC_POINT *arg_point;

            group_v = rb_iv_get(arg1, &quot;@group&quot;);
            SafeRequire_EC_GROUP(group_v, group);
            SafeRequire_EC_POINT(arg1, arg_point);

            point = EC_POINT_dup(arg_point, group);
        } else if (rb_obj_is_kind_of(arg1, cEC_GROUP)) {
            group_v = arg1;
            SafeRequire_EC_GROUP(group_v, group);

            point = EC_POINT_new(group);
        } else {
            rb_raise(eEC_POINT, &quot;wrong argument type: must be OpenSSL::PKey::EC::Point or OpenSSL::Pkey::EC::Group&quot;);
        }

        break;
     case 2:
        if (!rb_obj_is_kind_of(arg1, cEC_GROUP))
            rb_raise(rb_eArgError, &quot;1st argument must be OpenSSL::PKey::EC::Group&quot;);
        group_v = arg1;
        SafeRequire_EC_GROUP(group_v, group);
        
        if (rb_obj_is_kind_of(arg2, cBN)) {
            const BIGNUM *bn = GetBNPtr(arg2);

            point = EC_POINT_bn2point(group, bn, NULL, ossl_bn_ctx);
        } else {
            BIO *in = ossl_obj2bio(arg1);

/* BUG: finish me */

            BIO_free(in);

            if (point == NULL) {
                ossl_raise(eEC_POINT, &quot;unknown type for 2nd arg&quot;);
            }
        }
        break;
    default:
        rb_raise(rb_eArgError, &quot;wrong number of arguments&quot;);
    }

    if (point == NULL)
        ossl_raise(eEC_POINT, NULL);

    if (NIL_P(group_v))
        rb_raise(rb_eRuntimeError, &quot;missing group (internal error)&quot;);

    ec_point-&gt;point = point;

    rb_iv_set(self, &quot;@group&quot;, group_v);

    return self;
}</pre>
</body>
</html>
