<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>new (OpenSSL::PKey::RSA)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="../../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre>/*
 *  call-seq:
 *     RSA.new([size | encoded_key] [, pass]) -&gt; rsa
 *
 *  === Parameters
 *  * +size+ is an integer representing the desired key size.
 *  * +encoded_key+ is a string containing PEM or DER encoded key.
 *  * +pass+ is an optional string with the password to decrypt the encoded key.
 *
 *  === Examples
 *  * RSA.new(2048) -&gt; rsa 
 *  * RSA.new(File.read(&quot;rsa.pem&quot;)) -&gt; rsa
 *  * RSA.new(File.read(&quot;rsa.pem&quot;), &quot;mypassword&quot;) -&gt; rsa
 */
static VALUE
ossl_rsa_initialize(int argc, VALUE *argv, VALUE self)
{
    EVP_PKEY *pkey;
    RSA *rsa;
    BIO *in;
    char *passwd = NULL;
    VALUE arg, pass;
        
    GetPKey(self, pkey);
    if(rb_scan_args(argc, argv, &quot;02&quot;, &amp;arg, &amp;pass) == 0) {
        rsa = RSA_new();
    }
    else if (FIXNUM_P(arg)) {
        rsa = rsa_generate(FIX2INT(arg), NIL_P(pass) ? RSA_F4 : NUM2INT(pass));
        if (!rsa) ossl_raise(eRSAError, NULL);
    }
    else {
        if (!NIL_P(pass)) passwd = StringValuePtr(pass);
        arg = ossl_to_der_if_possible(arg);
        in = ossl_obj2bio(arg);
        rsa = PEM_read_bio_RSAPrivateKey(in, NULL, ossl_pem_passwd_cb, passwd);
        if (!rsa) {
            (void)BIO_reset(in);
            rsa = PEM_read_bio_RSAPublicKey(in, NULL, NULL, NULL);
        }
        if (!rsa) {
            (void)BIO_reset(in);
            rsa = PEM_read_bio_RSA_PUBKEY(in, NULL, NULL, NULL);
        }
        if (!rsa) {
            (void)BIO_reset(in);
            rsa = d2i_RSAPrivateKey_bio(in, NULL);
        }
        if (!rsa) {
            (void)BIO_reset(in);
            rsa = d2i_RSAPublicKey_bio(in, NULL);
        }
        if (!rsa) {
            (void)BIO_reset(in);
            rsa = d2i_RSA_PUBKEY_bio(in, NULL);
        }
        BIO_free(in);
        if (!rsa) ossl_raise(eRSAError, &quot;Neither PUB key nor PRIV key:&quot;);
    }
    if (!EVP_PKEY_assign_RSA(pkey, rsa)) {
        RSA_free(rsa);
        ossl_raise(eRSAError, NULL);
    }

    return self;
}</pre>
</body>
</html>
