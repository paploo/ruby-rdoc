<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>new (OpenSSL::SSL::Session)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="../../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre>/*
 * call-seq:
 *    Session.new(SSLSocket | string) =&gt; session
 *
 * === Parameters
 * +SSLSocket+ is an OpenSSL::SSL::SSLSocket
 * +string+ must be a DER or PEM encoded Session.
*/
static VALUE ossl_ssl_session_initialize(VALUE self, VALUE arg1)
{
        SSL_SESSION *ctx = NULL;

        if (RDATA(self)-&gt;data)
                ossl_raise(eSSLSession, &quot;SSL Session already initialized&quot;);

        if (rb_obj_is_instance_of(arg1, cSSLSocket)) {
                SSL *ssl;

                Data_Get_Struct(arg1, SSL, ssl);

                if (!ssl || (ctx = SSL_get1_session(ssl)) == NULL)
                        ossl_raise(eSSLSession, &quot;no session available&quot;);
        } else {
                BIO *in = ossl_obj2bio(arg1);

                ctx = PEM_read_bio_SSL_SESSION(in, NULL, NULL, NULL);

                if (!ctx) {
                        (void)BIO_reset(in);
                        ctx = d2i_SSL_SESSION_bio(in, NULL);
                }

                BIO_free(in);

                if (!ctx)
                        ossl_raise(rb_eArgError, &quot;unknown type&quot;);
        }

        /* should not happen */
        if (ctx == NULL)
                ossl_raise(eSSLSession, &quot;ctx not set - internal error&quot;);

        RDATA(self)-&gt;data = ctx;

        return self;
}</pre>
</body>
</html>
