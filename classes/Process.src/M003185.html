<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>daemon (Process)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre>/*
 *  call-seq:
 *     Process.daemon()                        =&gt; fixnum
 *     Process.daemon(nochdir=nil,noclose=nil) =&gt; fixnum
 *
 *  Detach the process from controlling terminal and run in
 *  the background as system daemon.  Unless the argument
 *  nochdir is true (i.e. non false), it changes the current
 *  working directory to the root (&quot;/&quot;). Unless the argument
 *  noclose is true, daemon() will redirect standard input,
 *  standard output and standard error to /dev/null.
 */

static VALUE
proc_daemon(int argc, VALUE *argv)
{
    VALUE nochdir, noclose;
#if defined(HAVE_DAEMON) || defined(HAVE_FORK)
    int n;
#endif

    rb_secure(2);
    rb_scan_args(argc, argv, &quot;02&quot;, &amp;nochdir, &amp;noclose);

#if defined(HAVE_DAEMON)
    n = daemon(RTEST(nochdir), RTEST(noclose));
    if (n &lt; 0) rb_sys_fail(&quot;daemon&quot;);
    return INT2FIX(n);
#elif defined(HAVE_FORK)
    switch (rb_fork(0, 0, 0, Qnil)) {
      case -1:
        return (-1);
      case 0:
        break;
      default:
        _exit(0);
    }

    proc_setsid();

    if (!RTEST(nochdir))
        (void)chdir(&quot;/&quot;);

    if (!RTEST(noclose) &amp;&amp; (n = open(&quot;/dev/null&quot;, O_RDWR, 0)) != -1) {
        (void)dup2(n, 0);
        (void)dup2(n, 1);
        (void)dup2(n, 2);
        if (n &gt; 2)
            (void)close (n);
    }
    return INT2FIX(0);
#else
    rb_notimplement();
#endif
}</pre>
</body>
</html>
