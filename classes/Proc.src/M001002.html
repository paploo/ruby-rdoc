<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>arity (Proc)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre>/*
 *  call-seq:
 *     prc.arity -&gt; fixnum
 *  
 *  Returns the number of arguments that would not be ignored. If the block
 *  is declared to take no arguments, returns 0. If the block is known
 *  to take exactly n arguments, returns n. If the block has optional
 *  arguments, return -n-1, where n is the number of mandatory
 *  arguments. A &lt;code&gt;proc&lt;/code&gt; with no argument declarations
 *  is the same a block declaring &lt;code&gt;||&lt;/code&gt; as its arguments.
 *     
 *     Proc.new {}.arity          #=&gt;  0
 *     Proc.new {||}.arity        #=&gt;  0
 *     Proc.new {|a|}.arity       #=&gt;  1
 *     Proc.new {|a,b|}.arity     #=&gt;  2
 *     Proc.new {|a,b,c|}.arity   #=&gt;  3
 *     Proc.new {|*a|}.arity      #=&gt; -1
 *     Proc.new {|a,*b|}.arity    #=&gt; -2
 *     Proc.new {|a,*b, c|}.arity    #=&gt; -3
 */

static VALUE
proc_arity(VALUE self)
{
    rb_proc_t *proc;
    rb_iseq_t *iseq;
    GetProcPtr(self, proc);
    iseq = proc-&gt;block.iseq;
    if (iseq) {
        if (BUILTIN_TYPE(iseq) != T_NODE) {
            if (iseq-&gt;arg_rest &lt; 0) {
                return INT2FIX(iseq-&gt;argc);
            }
            else {
                return INT2FIX(-(iseq-&gt;argc + 1 + iseq-&gt;arg_post_len));
            }
        }
        else {
            NODE *node = (NODE *)iseq;
            if (nd_type(node) == NODE_IFUNC &amp;&amp; node-&gt;nd_cfnc == bmcall) {
                /* method(:foo).to_proc.arity */
                return INT2FIX(method_arity(node-&gt;nd_tval));
            }
        }
    }
    return INT2FIX(-1);
}</pre>
</body>
</html>
