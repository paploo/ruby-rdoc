<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>result (GC::Profiler)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre>/*
 *  call-seq:
 *     GC::Profiler.result -&gt; string
 *
 *  Report profile data to string.
 *  
 *  It returns a string as:
 *   GC 1 invokes.
 *   Index    Invoke Time(sec)       Use Size(byte)     Total Size(byte)         Total Object                    GC time(ms)
 *       1               0.012               159240               212940                10647         0.00000000000001530000
 */

static VALUE
gc_profile_result(void)
{
    rb_objspace_t *objspace = &amp;rb_objspace;
    VALUE record;
    VALUE result;
    int i;
    
    record = gc_profile_record_get();
    if (objspace-&gt;profile.run &amp;&amp; objspace-&gt;profile.count) {
        result = rb_sprintf(&quot;GC %d invokes.\n&quot;, NUM2INT(gc_count(0)));
        rb_str_cat2(result, &quot;Index    Invoke Time(sec)       Use Size(byte)     Total Size(byte)         Total Object                    GC Time(ms)\n&quot;);
        for (i = 0; i &lt; (int)RARRAY_LEN(record); i++) {
            VALUE r = RARRAY_PTR(record)[i];
            rb_str_catf(result, &quot;%5d %19.3f %20d %20d %20d %30.20f\n&quot;,
                        i+1, NUM2DBL(rb_hash_aref(r, ID2SYM(rb_intern(&quot;GC_INVOKE_TIME&quot;)))),
                        NUM2INT(rb_hash_aref(r, ID2SYM(rb_intern(&quot;HEAP_USE_SIZE&quot;)))),
                        NUM2INT(rb_hash_aref(r, ID2SYM(rb_intern(&quot;HEAP_TOTAL_SIZE&quot;)))),
                        NUM2INT(rb_hash_aref(r, ID2SYM(rb_intern(&quot;HEAP_TOTAL_OBJECTS&quot;)))),
                        NUM2DBL(rb_hash_aref(r, ID2SYM(rb_intern(&quot;GC_TIME&quot;))))*1000);
        }
#if GC_PROFILE_MORE_DETAIL
        rb_str_cat2(result, &quot;\n\n&quot;);
        rb_str_cat2(result, &quot;More detail.\n&quot;);
        rb_str_cat2(result, &quot;Index Allocate Increase    Allocate Limit  Use Slot  Have Finalize             Mark Time(ms)            Sweep Time(ms)\n&quot;);
        for (i = 0; i &lt; (int)RARRAY_LEN(record); i++) {
            VALUE r = RARRAY_PTR(record)[i];
            rb_str_catf(result, &quot;%5d %17d %17d %9d %14s %25.20f %25.20f\n&quot;,
                        i+1, NUM2INT(rb_hash_aref(r, ID2SYM(rb_intern(&quot;ALLOCATE_INCREASE&quot;)))),
                        NUM2INT(rb_hash_aref(r, ID2SYM(rb_intern(&quot;ALLOCATE_LIMIT&quot;)))),
                        NUM2INT(rb_hash_aref(r, ID2SYM(rb_intern(&quot;HEAP_USE_SLOTS&quot;)))),
                        rb_hash_aref(r, ID2SYM(rb_intern(&quot;HAVE_FINALIZE&quot;)))? &quot;true&quot; : &quot;false&quot;,
                        NUM2DBL(rb_hash_aref(r, ID2SYM(rb_intern(&quot;GC_MARK_TIME&quot;))))*1000,
                        NUM2DBL(rb_hash_aref(r, ID2SYM(rb_intern(&quot;GC_SWEEP_TIME&quot;))))*1000);
        }
#endif
    }
    else {
        result = rb_str_new2(&quot;&quot;);
    }
    return result;
}</pre>
</body>
</html>
