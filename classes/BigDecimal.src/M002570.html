<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>to_f (BigDecimal)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre>/* Returns a new Float object having approximately the same value as the
 * BigDecimal number. Normal accuracy limits and built-in errors of binary
 * Float arithmetic apply.
 */
static VALUE
BigDecimal_to_f(VALUE self)
{
    ENTER(1);
    Real *p;
    double d;
    S_LONG e;
    char *buf;
    volatile VALUE str;

    GUARD_OBJ(p,GetVpValue(self,1));
    if (VpVtoD(&amp;d, &amp;e, p)!=1) return rb_float_new(d);
    if (e &gt; DBL_MAX_10_EXP+BASE_FIG) goto erange;
    str = rb_str_new(0, VpNumOfChars(p,&quot;E&quot;));
    buf = RSTRING_PTR(str);
    VpToString(p, buf, 0, 0);
    errno = 0;
    d = strtod(buf, 0);
    if(errno == ERANGE) {
      erange:
       VpException(VP_EXCEPTION_OVERFLOW,&quot;BigDecimal to Float conversion&quot;,0);
       if(d&gt;0.0) d = VpGetDoublePosInf();
       else      d = VpGetDoubleNegInf();
    }
    return rb_float_new(d);
}</pre>
</body>
</html>
