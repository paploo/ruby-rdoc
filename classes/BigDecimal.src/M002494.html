<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>to_int (BigDecimal)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre>/* Returns the value as an integer (Fixnum or Bignum).
 *
 * If the BigNumber is infinity or NaN, returns nil.
 */
static VALUE
BigDecimal_to_i(VALUE self)
{
    ENTER(5);
    int e,n,i,nf;
    U_LONG v,b,j;
    volatile VALUE str;
    char *psz,*pch;
    Real *p;

    GUARD_OBJ(p,GetVpValue(self,1));
    BigDecimal_check_num(p);

    e = VpExponent10(p);
    if(e&lt;=0) return INT2FIX(0);
    nf = VpBaseFig();
    if(e&lt;=nf) {
        e = VpGetSign(p)*p-&gt;frac[0];
        return INT2FIX(e);
    }
    str = rb_str_new(0, e+nf+2);
    psz = RSTRING_PTR(str);

    n = (e+nf-1)/nf;
    pch = psz;
    if(VpGetSign(p)&lt;0) *pch++ = '-';
    for(i=0;i&lt;n;++i) {
        b = VpBaseVal()/10;
        if(i&gt;=(int)p-&gt;Prec) {
            while(b) {
                *pch++ = '0';
                b /= 10;
            }
            continue;
        }
        v = p-&gt;frac[i];
        while(b) {
            j = v/b;
            *pch++ = (char)(j + '0');
            v -= j*b;
            b /= 10;
        }
    }
    *pch++ = 0;
    return rb_cstr2inum(psz,10);
}</pre>
</body>
</html>
