<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>get (GetoptLong)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre>     <span class="ruby-comment cmt"># File lib/getoptlong.rb, line 424</span>
424:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get</span>
425:     <span class="ruby-identifier">option_name</span>, <span class="ruby-identifier">option_argument</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-value str">''</span>
426: 
427:     <span class="ruby-comment cmt">#</span>
428:     <span class="ruby-comment cmt"># Check status.</span>
429:     <span class="ruby-comment cmt">#</span>
430:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@error</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
431:     <span class="ruby-keyword kw">case</span> <span class="ruby-ivar">@status</span>
432:     <span class="ruby-keyword kw">when</span> <span class="ruby-constant">STATUS_YET</span>
433:       <span class="ruby-ivar">@status</span> = <span class="ruby-constant">STATUS_STARTED</span>
434:     <span class="ruby-keyword kw">when</span> <span class="ruby-constant">STATUS_TERMINATED</span>
435:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
436:     <span class="ruby-keyword kw">end</span>
437: 
438:     <span class="ruby-comment cmt">#</span>
439:     <span class="ruby-comment cmt"># Get next option argument.</span>
440:     <span class="ruby-comment cmt">#</span>
441:     <span class="ruby-keyword kw">if</span> <span class="ruby-value">0</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@rest_singles</span>.<span class="ruby-identifier">length</span>
442:       <span class="ruby-identifier">argument</span> = <span class="ruby-value str">'-'</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@rest_singles</span>
443:     <span class="ruby-keyword kw">elsif</span> (<span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>)
444:       <span class="ruby-identifier">terminate</span>
445:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
446:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@ordering</span> <span class="ruby-operator">==</span> <span class="ruby-constant">PERMUTE</span>
447:       <span class="ruby-keyword kw">while</span> <span class="ruby-value">0</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">ARGV</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">!~</span> <span class="ruby-regexp re">/^-./</span>
448:         <span class="ruby-ivar">@non_option_arguments</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">shift</span>)
449:       <span class="ruby-keyword kw">end</span>
450:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
451:         <span class="ruby-identifier">terminate</span>
452:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
453:       <span class="ruby-keyword kw">end</span>
454:       <span class="ruby-identifier">argument</span> = <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">shift</span>
455:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@ordering</span> <span class="ruby-operator">==</span> <span class="ruby-constant">REQUIRE_ORDER</span> 
456:       <span class="ruby-keyword kw">if</span> (<span class="ruby-constant">ARGV</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">!~</span> <span class="ruby-regexp re">/^-./</span>)
457:         <span class="ruby-identifier">terminate</span>
458:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
459:       <span class="ruby-keyword kw">end</span>
460:       <span class="ruby-identifier">argument</span> = <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">shift</span>
461:     <span class="ruby-keyword kw">else</span>
462:       <span class="ruby-identifier">argument</span> = <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">shift</span>
463:     <span class="ruby-keyword kw">end</span>
464: 
465:     <span class="ruby-comment cmt">#</span>
466:     <span class="ruby-comment cmt"># Check the special argument `--'.</span>
467:     <span class="ruby-comment cmt"># `--' indicates the end of the option list.</span>
468:     <span class="ruby-comment cmt">#</span>
469:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">argument</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'--'</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@rest_singles</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
470:       <span class="ruby-identifier">terminate</span>
471:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
472:     <span class="ruby-keyword kw">end</span>
473: 
474:     <span class="ruby-comment cmt">#</span>
475:     <span class="ruby-comment cmt"># Check for long and short options.</span>
476:     <span class="ruby-comment cmt">#</span>
477:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">argument</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^(--[^=]+)/</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@rest_singles</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
478:       <span class="ruby-comment cmt">#</span>
479:       <span class="ruby-comment cmt"># This is a long style option, which start with `--'.</span>
480:       <span class="ruby-comment cmt">#</span>
481:       <span class="ruby-identifier">pattern</span> = <span class="ruby-identifier">$1</span>
482:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@canonical_names</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">pattern</span>)
483:         <span class="ruby-identifier">option_name</span> = <span class="ruby-identifier">pattern</span>
484:       <span class="ruby-keyword kw">else</span>
485:         <span class="ruby-comment cmt">#</span>
486:         <span class="ruby-comment cmt"># The option `option_name' is not registered in `@canonical_names'.</span>
487:         <span class="ruby-comment cmt"># It may be an abbreviated.</span>
488:         <span class="ruby-comment cmt">#</span>
489:         <span class="ruby-identifier">matches</span> = []
490:         <span class="ruby-ivar">@canonical_names</span>.<span class="ruby-identifier">each_key</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
491:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">pattern</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
492:             <span class="ruby-identifier">option_name</span> = <span class="ruby-identifier">key</span>
493:             <span class="ruby-identifier">matches</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">key</span>
494:           <span class="ruby-keyword kw">end</span>
495:         <span class="ruby-keyword kw">end</span>
496:         <span class="ruby-keyword kw">if</span> <span class="ruby-value">2</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">matches</span>.<span class="ruby-identifier">length</span>
497:           <span class="ruby-identifier">set_error</span>(<span class="ruby-constant">AmbiguousOption</span>, <span class="ruby-node">&quot;option `#{argument}' is ambiguous between #{matches.join(', ')}&quot;</span>)
498:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">matches</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
499:           <span class="ruby-identifier">set_error</span>(<span class="ruby-constant">InvalidOption</span>, <span class="ruby-node">&quot;unrecognized option `#{argument}'&quot;</span>)
500:         <span class="ruby-keyword kw">end</span>
501:       <span class="ruby-keyword kw">end</span>
502: 
503:       <span class="ruby-comment cmt">#</span>
504:       <span class="ruby-comment cmt"># Check an argument to the option.</span>
505:       <span class="ruby-comment cmt">#</span>
506:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@argument_flags</span>[<span class="ruby-identifier">option_name</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">REQUIRED_ARGUMENT</span>
507:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">argument</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/=(.*)$/</span>
508:           <span class="ruby-identifier">option_argument</span> = <span class="ruby-identifier">$1</span>
509:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-value">0</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">length</span>
510:           <span class="ruby-identifier">option_argument</span> = <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">shift</span>
511:         <span class="ruby-keyword kw">else</span>
512:           <span class="ruby-identifier">set_error</span>(<span class="ruby-constant">MissingArgument</span>,
513:                     <span class="ruby-node">&quot;option `#{argument}' requires an argument&quot;</span>)
514:         <span class="ruby-keyword kw">end</span>
515:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@argument_flags</span>[<span class="ruby-identifier">option_name</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">OPTIONAL_ARGUMENT</span>
516:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">argument</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/=(.*)$/</span>
517:           <span class="ruby-identifier">option_argument</span> = <span class="ruby-identifier">$1</span>
518:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-value">0</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">ARGV</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">!~</span> <span class="ruby-regexp re">/^-./</span>
519:           <span class="ruby-identifier">option_argument</span> = <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">shift</span>
520:         <span class="ruby-keyword kw">else</span>
521:           <span class="ruby-identifier">option_argument</span> = <span class="ruby-value str">''</span>
522:         <span class="ruby-keyword kw">end</span>
523:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">argument</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/=(.*)$/</span>
524:         <span class="ruby-identifier">set_error</span>(<span class="ruby-constant">NeedlessArgument</span>,
525:                   <span class="ruby-node">&quot;option `#{option_name}' doesn't allow an argument&quot;</span>)
526:       <span class="ruby-keyword kw">end</span>
527: 
528:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">argument</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^(-(.))(.*)/</span>
529:       <span class="ruby-comment cmt">#</span>
530:       <span class="ruby-comment cmt"># This is a short style option, which start with `-' (not `--').</span>
531:       <span class="ruby-comment cmt"># Short options may be catenated (e.g. `-l -g' is equivalent to</span>
532:       <span class="ruby-comment cmt"># `-lg').</span>
533:       <span class="ruby-comment cmt">#</span>
534:       <span class="ruby-identifier">option_name</span>, <span class="ruby-identifier">ch</span>, <span class="ruby-ivar">@rest_singles</span> = <span class="ruby-identifier">$1</span>, <span class="ruby-identifier">$2</span>, <span class="ruby-identifier">$3</span>
535: 
536:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@canonical_names</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">option_name</span>)
537:         <span class="ruby-comment cmt">#</span>
538:         <span class="ruby-comment cmt"># The option `option_name' is found in `@canonical_names'.</span>
539:         <span class="ruby-comment cmt"># Check its argument.</span>
540:         <span class="ruby-comment cmt">#</span>
541:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@argument_flags</span>[<span class="ruby-identifier">option_name</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">REQUIRED_ARGUMENT</span>
542:           <span class="ruby-keyword kw">if</span> <span class="ruby-value">0</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@rest_singles</span>.<span class="ruby-identifier">length</span>
543:             <span class="ruby-identifier">option_argument</span> = <span class="ruby-ivar">@rest_singles</span>
544:             <span class="ruby-ivar">@rest_singles</span> = <span class="ruby-value str">''</span>
545:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-value">0</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">length</span>
546:             <span class="ruby-identifier">option_argument</span> = <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">shift</span>
547:           <span class="ruby-keyword kw">else</span>
548:             <span class="ruby-comment cmt"># 1003.2 specifies the format of this message.</span>
549:             <span class="ruby-identifier">set_error</span>(<span class="ruby-constant">MissingArgument</span>, <span class="ruby-node">&quot;option requires an argument -- #{ch}&quot;</span>)
550:           <span class="ruby-keyword kw">end</span>
551:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@argument_flags</span>[<span class="ruby-identifier">option_name</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">OPTIONAL_ARGUMENT</span>
552:           <span class="ruby-keyword kw">if</span> <span class="ruby-value">0</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@rest_singles</span>.<span class="ruby-identifier">length</span>
553:             <span class="ruby-identifier">option_argument</span> = <span class="ruby-ivar">@rest_singles</span>
554:             <span class="ruby-ivar">@rest_singles</span> = <span class="ruby-value str">''</span>
555:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-value">0</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">ARGV</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">!~</span> <span class="ruby-regexp re">/^-./</span>
556:             <span class="ruby-identifier">option_argument</span> = <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">shift</span>
557:           <span class="ruby-keyword kw">else</span>
558:             <span class="ruby-identifier">option_argument</span> = <span class="ruby-value str">''</span>
559:           <span class="ruby-keyword kw">end</span>
560:         <span class="ruby-keyword kw">end</span>
561:       <span class="ruby-keyword kw">else</span>
562:         <span class="ruby-comment cmt">#</span>
563:         <span class="ruby-comment cmt"># This is an invalid option.</span>
564:         <span class="ruby-comment cmt"># 1003.2 specifies the format of this message.</span>
565:         <span class="ruby-comment cmt">#</span>
566:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">'POSIXLY_CORRECT'</span>)
567:           <span class="ruby-identifier">set_error</span>(<span class="ruby-constant">InvalidOption</span>, <span class="ruby-node">&quot;invalid option -- #{ch}&quot;</span>)
568:         <span class="ruby-keyword kw">else</span>
569:           <span class="ruby-identifier">set_error</span>(<span class="ruby-constant">InvalidOption</span>, <span class="ruby-node">&quot;invalid option -- #{ch}&quot;</span>)
570:         <span class="ruby-keyword kw">end</span>
571:       <span class="ruby-keyword kw">end</span>
572:     <span class="ruby-keyword kw">else</span>
573:       <span class="ruby-comment cmt">#</span>
574:       <span class="ruby-comment cmt"># This is a non-option argument.</span>
575:       <span class="ruby-comment cmt"># Only RETURN_IN_ORDER falled into here.</span>
576:       <span class="ruby-comment cmt">#</span>
577:       <span class="ruby-keyword kw">return</span> <span class="ruby-value str">''</span>, <span class="ruby-identifier">argument</span>
578:     <span class="ruby-keyword kw">end</span>
579: 
580:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@canonical_names</span>[<span class="ruby-identifier">option_name</span>], <span class="ruby-identifier">option_argument</span>
581:   <span class="ruby-keyword kw">end</span></pre>
</body>
</html>
